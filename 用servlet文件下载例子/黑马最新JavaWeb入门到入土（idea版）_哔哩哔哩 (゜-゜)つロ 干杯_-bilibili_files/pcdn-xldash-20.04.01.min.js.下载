"use strict";function Ht(t,i,s){return i&&n(t.prototype,i),s&&n(t,s),t}function n(t,i){for(var s=0;s<i.length;s++){var n=i[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Yt(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}function zt(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}function Jt(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var xyvp=function(t){var c=window,r=(i.format=function(t){return t.getFullYear()+"-"+(t.getMonth()+1<10?"0"+(t.getMonth()+1)+"-":t.getMonth()+1+"-")+(t.getDate()<10?"0"+t.getDate()+" ":t.getDate()+" ")+(t.getHours()<10?"0"+t.getHours()+":":t.getHours()+":")+(t.getMinutes()<10?"0"+t.getMinutes()+":":t.getMinutes()+":")+(t.getSeconds()<10?"0"+t.getSeconds()+".":t.getSeconds()+".")+(t.getMilliseconds()<10?"00"+t.getMilliseconds():t.getMilliseconds()<100?"0"+t.getMilliseconds():""+t.getMilliseconds())},i);function i(){Jt(this,i)}var u={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,FATAL:5,OFF:99},o={TRACE:"background-color:#cccccc",DEBUG:"",INFO:"color:#ffffff;background-color:#00BFFF",WARN:"color:#ffffff;background-color:#FFA500",ERROR:"color:#ffffff;background-color:#FF0000",FATAL:"color:#ffffff;background-color:#9370DB"},n={};function s(){var t=0<arguments.length&&arguments[0]!==undefined?arguments[0]:{};Jt(this,s),this.level=t.level||u.OFF,this.namingSpace=t.namingSpace||""}var h=(s.prototype.trace=function(){for(var t=arguments.length,i=Array(t),s=0;s<t;s++)i[s]=arguments[s];this.t.apply(this,["TRACE"].concat(i))},s.prototype.debug=function(){for(var t=arguments.length,i=Array(t),s=0;s<t;s++)i[s]=arguments[s];this.t.apply(this,["DEBUG"].concat(i))},s.prototype.info=function(){for(var t=arguments.length,i=Array(t),s=0;s<t;s++)i[s]=arguments[s];this.t.apply(this,["INFO"].concat(i))},s.prototype.warn=function(){for(var t=arguments.length,i=Array(t),s=0;s<t;s++)i[s]=arguments[s];this.t.apply(this,["WARN"].concat(i))},s.prototype.error=function(){for(var t=arguments.length,i=Array(t),s=0;s<t;s++)i[s]=arguments[s];this.t.apply(this,["ERROR"].concat(i)),n.ErrorHook&&n.ErrorHook([].concat(i).join(" "))},s.prototype.fatal=function(){for(var t=arguments.length,i=Array(t),s=0;s<t;s++)i[s]=arguments[s];this.t.apply(this,["FATAL"].concat(i))},s.prototype.t=function(t){var i;if(!(u[t]<this.level)){for(var s=arguments.length,n=Array(1<s?s-1:0),h=1;h<s;h++)n[h-1]=arguments[h];var e=n.shift();n.unshift(e.constructor.name),e.i&&e.i.mediaType&&n.unshift(e.i.mediaType),(i=console).log.apply(i,[r.format(new Date)+" "+this.namingSpace+" %c["+t+"]",o[t]].concat(n))}},new s({level:u.INFO,namingSpace:"Dash"}));n.TRACE=function(){return h.trace.apply(h,arguments)},n.DEBUG=function(){return h.debug.apply(h,arguments)},n.INFO=function(){return h.info.apply(h,arguments)},n.WARN=function(){return h.warn.apply(h,arguments)},n.ERROR=function(){return h.error.apply(h,arguments)},n.FATAL=function(){return h.fatal.apply(h,arguments)};var e=(f.prototype.toString=function(){return this.name+": "+this.message},f);function f(t){Jt(this,f),this.message=t}var a,l=(zt(d,a=e),Ht(d,[{key:"name",get:function(){return"InvalidArgumentError"}}]),d);function d(){return Jt(this,d),Yt(this,a.apply(this,arguments))}var v,w=(zt(p,v=e),Ht(p,[{key:"name",get:function(){return"ResponseError"}}]),p);function p(t,i){Jt(this,p);var s=Yt(this,v.call(this,t));return s.status=i,s}var g,b=(zt(y,g=e),Ht(y,[{key:"name",get:function(){return"NetworkError"}}]),y);function y(){return Jt(this,y),Yt(this,g.apply(this,arguments))}function m(t){return"number"==typeof t}function k(t,i){var s=1<arguments.length&&i!==undefined?i:2;return"number"!=typeof t?0:Number(t.toFixed(s))}var E=function E(t,i,s){Jt(this,E),this.name=t,this.version=i,this.os=s,this.type="browser"},O=function O(t){Jt(this,O),this.version=t,this.type="node",this.name="node",this.os=process.platform},T=function T(t,i,s,n){Jt(this,T),this.name=t,this.version=i,this.os=s,this.bot=n,this.type="bot-device"},D=function D(){Jt(this,D),this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},S=/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/,A=[["aol",/AOLShield\/([0-9._]+)/],["edge",/Edge\/([0-9._]+)/],["edge-ios",/EdgiOS\/([0-9._]+)/],["yandexbrowser",/YaBrowser\/([0-9._]+)/],["kakaotalk",/KAKAOTALK\s([0-9.]+)/],["samsung",/SamsungBrowser\/([0-9.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9.]+)$/],["beaker",/BeakerBrowser\/([0-9.]+)/],["edge-chromium",/Edg\/([0-9.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9.]+)(:?\s|$)/],["crios",/CriOS\/([0-9.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9.]+)/],["opera",/Opera\/([0-9.]+)(?:\s|$)/],["opera",/OPR\/([0-9.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv:([0-9.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9.]+)/],["android",/Android\s([0-9.]+)/],["ios",/Version\/([0-9._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9._]+).*Safari/],["facebook",/FBAV\/([0-9.]+)/],["instagram",/Instagram\s([0-9.]+)/],["ios-webview",/AppleWebKit\/([0-9.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9.]+).*Gecko\)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],R=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function N(t){var h,i=""!==(h=t)&&A.reduce(function(t,i){var s=i[0];if(t)return t;var n=i[1].exec(h);return!!n&&[s,n]},!1);if(!i)return null;var s=i[0],n=i[1];if("searchbot"===s)return new D;var e=n[1]&&n[1].split(/[._]/).slice(0,3);e?e.length<3&&(e=[].concat(e,function(t){for(var i=[],s=0;s<t;s++)i.push("0");return i}(3-e.length))):e=[];var r={};e[0]!==undefined&&(r.major=parseInt(e[0],10)),e[1]!==undefined&&(r.minor=parseInt(e[1],10)),e[2]!==undefined&&(r.build=parseInt(e[2],10));var u=function(t){for(var i=0,s=R.length;i<s;i++){var n=R[i],h=n[0];if(n[1].exec(t))return h}return null}(t),o=S.exec(t);return o&&o[1]?new T(s,r,u,o[1]):new E(s,r,u)}var I,C="function"==typeof Object.create?Object.create(null):{},B=function B(){return!(!c.document||!c.document.location)&&/^https:/.test(c.document.location.href)},W=function W(){return c.navigator&&c.navigator.userAgent?c.navigator.userAgent:""},M=function M(){try{return!(!c.fetch||!c.ReadableStream||"edge"===C.browser.name)}catch(t){return!1}},L=function L(){if(!C.browser.firefox)return!1;try{var t=new c.XMLHttpRequest;return t.open("GET","https://example.com",!0),(t.responseType="moz-chunked-arraybuffer")===t.responseType}catch(i){return!1}},x=function x(){return"function"==typeof Uint8Array&&Uint8Array.prototype.slice!==undefined},j=function j(){return!!c.sessionStorage},_=function _(){return C.VERSION.split("-")[0]};C.VERSION="1.2.8",C.RELEASE_VERSION=_(),C.MAX_BKJ_NUM=1,C.BUFFER_LIMIT=15,C.BUFFER_FALLBACK=10,C.PREFLIGHT_TEIMOUT=2e3,C.REQUEST_TIMEOUT=1500,C.RECEIVE_TIMEOUT=1500,C.SUSPEND_RANGE_LENGTH=2097152,C.ABNORMAL_CLOSE_LIMIT=2,C.MIN_BUFFER_LIMIT=2,C.MIN_BUFFER_FALLBACK=1,C.MIN_PREFLIGHT_TEIMOUT=500,C.MIN_REQUEST_TIMEOUT=500,C.MIN_RECEIVE_TIMEOUT=500,C.MIN_SUSPEND_RANGE_LENGTH=1024,C.MIN_ABNORMAL_CLOSE_LIMIT=1,C.RANGE_REGEX=/^bytes\s(\d+)-(\d*)\/?(\d*)/,C.browser=I?N(I):"undefined"!=typeof navigator?N(c.navigator.userAgent):"undefined"!=typeof process&&process.version?new O(process.version.slice(1)):null,C.isHttps=B(),C.http=C.isHttps?"https":"http",C.userAgent=W(),C.isFetchStreamSupported=M(),C.isMozChunkedSupported=L(),C.isSessionStorageSupported=j(),C.isTypedArraySupported=x();var G=(F.prototype.assign=function(t,i){this.s=t,this.n=i,this.h=t+i},F.prototype.isIn=function(t){return this.s<=t&&t<this.h},F.prototype.isContained=function(t){if(0===t.length)throw new RangeError("isContained, range.length is 0");return this.s<=t.position&&t.end<=this.h},F.prototype.isIntersect=function(t){if(0===t.length)throw new RangeError("isIntersect, range.length is 0");return!(this.h<t.position||t.end<=this.s)},F.prototype.isFullRange=function(){return 0===this.s&&this.n===F.MAX_LENGTH},F.prototype.equalTo=function(t){return this.s===t.position&&this.n===t.length},F.prototype.toString=function(){return"["+this.s+","+this.n+","+this.h+")"},F.prototype.valueOf=function(){return{start:this.s,end:this.h}},F.prototype.clone=function(){return new F(this.s,this.n)},F.prototype.canMerge=function(t){if(0===t.length)throw new RangeError("canMerge, range.length is 0");return!(t.end<this.s||this.h<t.position)},F.prototype.merge=function(t){if(!(1<arguments.length&&arguments[1]!==undefined&&arguments[1]||this.canMerge(t)))throw new RangeError("merge, over bound");var i=Math.min(this.s,t.position);return new F(i,Math.max(this.h,t.end)-i)},F.prototype.intersect=function(t){if(0===t.length)throw new RangeError("intersect, range.length is 0");if(t.end<=this.s||this.h<=t.position)return null;var i=this.s<t.position?t.position:this.s;return new F(i,(t.end<this.h?t.end:this.h)-i)},Ht(F,[{key:"position",get:function(){return this.s}},{key:"length",get:function(){return this.n}},{key:"end",get:function(){return this.h}}]),F);function F(t,i){if(Jt(this,F),i<0)throw new RangeError("length should not be negative.");this.assign(t,i)}G.MAX_LENGTH=0xffffffffffff;var U=(P.prototype.isIn=function(t){for(var i=!1,s=0,n=this.e.length;s<n;s++)if(this.e[s].isIn(t)){i=!0;break}return i},P.prototype.getRange=function(t){for(var i=null,s=0,n=this.e.length;s<n;s++){var h=this.e[s];if(h.isIn(t)){i=h;break}}return i},P.prototype.indexOf=function(t){for(var i=this.e.length,s=0;s<i;s++)if(this.e[s].isIn(t)||this.e[s].end===t)return s;return-1},P.prototype.slice=function(t){var i=new P,s=t.position,n=t.end;if(0===t.length||this.h<=s||n<=this.r)return i;for(var h=0,e=0,r=0,u=this.e.length;r<u;r++){var o=this.e[r];if(s<o.position)h=o.position;else{if(!(s<o.end))continue;h=s}e=r;break}for(var f=0,a=0,c=this.e.length-1;0<=c;c--){var l=this.e[c];if(l.end<n)f=l.end;else{if(!(l.position<n))continue;f=n}a=c;break}if(e===a)return i.addRange(new G(h,f-h)),i;for(var d=e,v=a+1;d<v;d++){var w=this.e[d];i.addRange(d===e?new G(h,w.end-h):d===a?new G(w.position,f-w.position):w)}return i},P.prototype.isContained=function(t){if(0===t.length)throw new RangeError("isContained, range.length is 0");if(0===this.e.length)return!1;for(var i=0,s=this.e.length;i<s;i++)if(this.e[i].isContained(t))return!0;return!1},P.prototype.addRange=function(t){if(0===t.length)throw new RangeError("addRange, range.length is 0");var i=this.e.length;if(0===i||this.h<t.position)this.e.push(t.clone());else if(t.end<this.r)this.e.unshift(t.clone());else{for(var s=0,n=i-1;0<=n;n--)if(this.e[n].end<t.position){s=n+1;break}for(var h=i-1,e=0;e<i;e++)if(t.end<this.e[e].position){h=e-1;break}var r=this.e[s],u=this.e[h],o=t.clone();r.position<=t.position&&t.position<=r.end&&(o=o.merge(r,!0)),u.position<=t.end&&t.end<=u.end&&(o=o.merge(u,!0)),this.e.splice(s,h-s+1,o)}this.u()},P.prototype.removeRange=function(t){var i;if(0===t.length)throw new RangeError("removeRange, range.length is 0");var s=this.e.length;if(!(0===s||this.h<=t.position||t.end<=this.r)){for(var n=0,h=s-1;0<=h;h--)if(this.e[h].end<=t.position){n=h+1;break}for(var e=s-1,r=0;r<s;r++)if(t.end<=this.e[r].position){e=r-1;break}var u=this.e[n],o=this.e[e],f=[];u.position<t.position&&t.position<u.end&&f.push(new G(u.position,t.position-u.position)),o.position<t.end&&t.end<o.end&&f.push(new G(t.end,o.end-t.end)),(i=this.e).splice.apply(i,[n,e-n+1].concat(f)),this.u()}},P.prototype.clone=function(){for(var t=this.e,i=t.length,s=new P,n=0;n<i;n++)s.addRange(t[n].clone());return s},P.prototype.equalTo=function(t){if(this.e.length!==t.ranges.length)return!1;for(var i=0,s=this.e.length;i<s;i++)if(!this.e[i].equalTo(t.ranges[i]))return!1;return!0},P.prototype.clear=function(){this.e=[],this.r=0,this.h=0},P.prototype.toString=function(){return"{"+this.e.join(",")+"}"},P.prototype.valueOf=function(){for(var t=[],i=0;i<this.e.length;i++)t.push(this.e[i].valueOf());return t},P.prototype.u=function(){0!==this.e.length&&(this.r=this.e[0].position,this.h=this.e[this.e.length-1].end)},P.prototype.reverse=function(){for(var t=0<arguments.length&&arguments[0]!==undefined?arguments[0]:0,i=arguments[1],s=new P,n=t+(i=i||this.end-this.start),h=t,e=0;e<this.ranges.length&&!(n<h);e++){if(h<this.ranges[e].position){var r=this.ranges[e].position;s.addRange(new G(h,(r<n?r:n)-h))}h<this.ranges[e].end&&(h=this.ranges[e].end)}return h<i&&s.addRange(new G(h,i-h)),s},Ht(P,[{key:"length",get:function(){for(var t=0,i=this.e.length;i--;)t+=this.e[i].length;return t}},{key:"ranges",get:function(){return this.e}},{key:"end",get:function(){return this.h}},{key:"start",get:function(){return this.r}}]),P);function P(){Jt(this,P),this.e=[],this.r=0,this.h=0}var K=(V.prototype.addBytes=function(t){var i=Math.floor(Date.now()/this.o);this.f(i),this.a[i]+=t},V.prototype.calculate=function(){var i=this,s=Math.floor(Date.now()/this.o);this.f(s);var n=0,h=0;return Object.keys(this.a).forEach(function(t){parseInt(t,10)!==s&&(n+=i.a[t],h++)}),0===h?0:n/h*(1e3/this.o)},V.prototype.f=function(i){var s=this;Object.keys(this.a).forEach(function(t){parseInt(t,10)+s.c<=i&&delete s.a[t]});for(var t=i;i-this.c<t;t--)this.a[t]===undefined&&(this.a[t]=0)},V);function V(t){var i=1<arguments.length&&arguments[1]!==undefined?arguments[1]:1e3;Jt(this,V),this.a={},this.c=t,this.o=i}var X="WAITING",$="cdn",Q=1,H=(Y.prototype.recvBytesDiffer=function(){var t=this.l-this.d;return this.d=this.l,t},Y.prototype.downloadTimeDiffer=function(){var t=this.v-this.w;return this.w=this.v,t},Y.prototype.onRequestData=function(t,i){this.p=Date.now()},Y.prototype.onReceiveData=function(t,i){this.g.addBytes(i),this.l+=i;var s=Date.now();0<this.b&&(this.v+=s-this.b),this.b=s},Y.prototype.onReceiveEnd=function(){},Y.prototype.onClose=function(t){switch(this.y=Date.now(),this.m=t){case 0:this.k=2;break;case 104:this.k=3;break;case 7:case 8:case 9:case 101:case 6:this.k=4;break;default:this.k=9}},Ht(Y,[{key:"speedCalc",get:function(){return this.g}},{key:"closeReason",get:function(){return this.m}},{key:"shortName",get:function(){return this.O.type!==$?this.O.type+"|"+this.O.hostname.slice(0,5):""+this.O.type}},{key:"state",get:function(){switch(this.O.state){case 1:return"CHECKING";case 2:return"IDLE";case 3:return"REQUESTED";case 4:return"LOADING";case 5:return"CLOSED";default:return"WAITING"}}},{key:"lastQuality",get:function(){return this.k}},{key:"requestTick",get:function(){return this.p}},{key:"receiveTick",get:function(){return this.b}},{key:"downloadTime",get:function(){return this.v}},{key:"info",get:function(){return{hostname:this.O.hostname,state:this.state,recvBytes:this.l,speed:k(this.g.calculate()/1024)+"(KB/s)",time:this.v+"(ms)"}}}]),Y);function Y(t){Jt(this,Y),this.O=t,this.p=0,this.b=0,this.l=0,this.y=0,this.v=0,this.k=Q,this.d=0,this.w=0,this.m=0,this.g=new K(5,200)}var z=(J.prototype.set=function(t,i){this.T[t]=i},J.prototype.get=function(t){return this.T[t]},J.prototype.has=function(t){return this.T[t]!==undefined},J.prototype.remove=function(t){return this.T[t]!==undefined&&(delete this.T[t],!0)},J.prototype.clear=function(){for(var t=Object.keys(this.T),i=t.length;i--;)this.remove(t[i])},J.prototype.forEach=function(t){if(t instanceof Function)for(var i=Object.keys(this.T),s=0,n=i.length;s<n;s++){var h=i[s];t(this.T[h],h)}},J.prototype.size=function(){return Object.keys(this.T).length},Ht(J,[{key:"allPipes",get:function(){return this.T}}]),J);function J(){Jt(this,J),this.T="function"==typeof Object.create?Object.create(null):{}}var q,Z=(zt(tt,q=z),tt.prototype.waitingPipes=function(){var i=[];return this.forEach(function(t){t.state===X&&i.push(t)}),i},tt.prototype.idlePipes=function(){var i=[];return this.forEach(function(t){"IDLE"===t.state&&i.push(t)}),i},tt.prototype.avaliablePipes=function(){var i=[];return this.forEach(function(t){t.state!==X&&"CLOSED"!==t.state&&i.push(t)}),i},tt);function tt(){return Jt(this,tt),Yt(this,q.apply(this,arguments))}var it={generate:function(){for(var t="",i=1;i<=32;i++)t+=Math.floor(16*Math.random()).toString(16),8!==i&&12!==i&&16!==i&&20!==i||(t+="-");return t}},st=/; */;function nt(t,i){try{return i(t)}catch(s){return t}}var ht={parse:function(t,i){if("string"!=typeof t)throw new TypeError("argument str must be a string");for(var s={},n=i||{},h=t.split(st),e=n.decode||c.decodeURIComponent,r=0;r<h.length;r++){var u=h[r],o=u.indexOf("=");if(!(o<0)){var f=u.substr(0,o).trim(),a=u.substr(++o,u.length).trim();'"'===a[0]&&(a=a.slice(1,-1)),undefined===s[f]&&(s[f]=nt(a,e))}}return s}},et=function et(t){return c.decodeURI(t)===t?c.encodeURI(t):t},rt=(ut.prototype.getBufferedEnd=function(t){var i=this.mediaElement;if(!i||!i.buffered||0===i.buffered.length)return 0;for(var s=0,n=i.buffered.length;s<n;s++)if(t>=i.buffered.start(s)&&t<i.buffered.end(s))return i.buffered.end(s);return 0},ut.prototype.isBuffered=function(t){var i=this.mediaElement;if(!i)return!1;for(var s=0;s<i.buffered.length;s++)if(t>=i.buffered.start(s)&&t<i.buffered.end(s))return!0;return!1},ut.prototype.getTimeFromRange=function(t){for(var i=0,s=0;s<t.length;s++)i+=t.end(s)-t.start(s);return i},ut.prototype.parseTimeRanges=function(t){for(var i=[],s=0,n=t.length;s<n;s++)i.push(t.start(s)+"~"+t.end(s));return i},ut.prototype.dispose=function(){this.mediaElement=null,this.pipeManager.clear(),this.blackPipeList.clear()},Ht(ut,[{key:"duration",get:function(){var t=this.mediaElement;return t&&t.duration?t.duration:0}},{key:"bufferLength",get:function(){var t=this.mediaElement;if(!t||!t.buffered||0===t.buffered.length)return 0;try{for(var i=0,s=t.buffered.length;i<s;i++){var n=t.buffered.start(i),h=t.buffered.end(i);if(n<=t.currentTime+.2&&t.currentTime<h)return h-t.currentTime}}catch(e){}return 0}},{key:"playTime",get:function(){var t=this.mediaElement;return t&&t.currentTime!==undefined?t.currentTime:-1}},{key:"buffered",get:function(){var t=this.mediaElement;return t?this.parseTimeRanges(t.buffered):"{}"}},{key:"seekable",get:function(){var t=this.mediaElement;return t?this.parseTimeRanges(t.seekable):"{}"}},{key:"played",get:function(){var t=this.mediaElement;return t?this.parseTimeRanges(t.played):"{}"}},{key:"isMediaPaused",get:function(){var t=this.mediaElement;return!t||t.paused&&1<t.readyState}},{key:"isMediaEnded",get:function(){var t=this.mediaElement;return!t||t.ended}},{key:"pipes",get:function(){var i={waiting:[],checking:[],idle:[],serving:[],closed:[]};return this.pipeManager.forEach(function(t){t.state===X?i.waiting.push(t.client.info):"CHECKING"===t.state?i.checking.push(t.client.info):"IDLE"===t.state?i.idle.push(t.client.info):"CLOSED"===t.state?i.closed.push(t.client.info):i.serving.push(t.client.info)}),JSON.stringify(i,null,4)}},{key:"peerRatio",get:function(){var t=this.cdnBytes+this.bkjBytes;return 0<t?(100*this.bkjBytes/t).toFixed(2):(0).toFixed(2)}}]),ut);function ut(t){var i=this;Jt(this,ut),this.mediaElement=t.media||t.video||t.audio,this.withCredentials=!!t.withCredentials,this.mediaType=t.mediaType?t.mediaType:"",this.speedCalc=new K(5,200),this.cdnSpeedCalc=new K(5,200),this.p2pSpeedCalc=new K(5,200),this.url=et(t.url),this.currentUrl=this.url;var s=ht.parse(c.document.cookie);this.uuid="",Object.keys(s).forEach(function(t){"_uuid"===t&&(i.uuid=s[t])}),this.playId=c.player&&c.player.getSession?c.player.getSession():it.generate(),this.reserveRg=new G(0,0),this.downloadRgq=new U,this.pipeManager=new Z,this.blackPipeList=new z,this.requestQueue=[],this.fileSize=0,this.lastModified=0,this.firstBuffer=0,this.sendPos=0,this.cdnBytes=0,this.bkjBytes=0,this.seekPosition=0,this.seekType=0,this.seekCost=0,this.interruptCount=0,this.interruptTime=0,this.currentPipe="",this.bufferLimit=C.BUFFER_LIMIT,this.bufferFallback=C.BUFFER_FALLBACK,this.requestTimeout=C.REQUEST_TIMEOUT,this.receiveTimeout=C.RECEIVE_TIMEOUT,this.preflightTimeout=C.PREFLIGHT_TEIMOUT,this.suspendRangeLength=C.SUSPEND_RANGE_LENGTH,this.abnormalCloseLimit=C.ABNORMAL_CLOSE_LIMIT}var ot=C.http+"://sdk1xyajs-data.xycdn.com/o_vod_h5sdk_one",ft=C.http+"://sdk1xyajs-data.xycdn.com/o_vod_h5sdk_cycle",at=["logstate","v","pi","ua","u","mt","ui","fb","fs","lm"],ct=["logstate","v","pi","ua","u","mt","ui","sp","st","sc","bl","ss","bf"],lt=["v","pi","ua","u","mt","ui","it","ic","dc","db","pt","bla","bld","pr","dm","spa","br","fs","du"],dt=["logstate","v","pi","ua","u","mt","ui","e","bl","bf","si"],vt=(wt.prototype.onBufferFull=function(t){this.D=!1;var i=(this.S=t)-Math.max(this.A,this.R);this.i.interruptTime+=Math.min(i,15e3),this.N.push({ct:this.i.playTime.toFixed(3),bf:this.i.buffered,wt:this.S-this.A,cp:this.i.currentPipe,sp:this.i.speedCalc.calculate().toFixed(),sd:this.i.sendPos})},wt.prototype.onBufferEmpty=function(t){this.D=!0,this.A=t,this.i.interruptCount+=1,this.I.push({ct:this.i.playTime.toFixed(3),bf:this.i.buffered,cp:this.i.currentPipe,sp:this.i.speedCalc.calculate().toFixed(),sd:this.i.sendPos})},wt.prototype.startInterval=function(){-1===this.C&&this.B()},wt.prototype.stopInterval=function(){-1!==this.C&&(this.W(),clearTimeout(this.C),this.C=-1)},wt.prototype.sendERR=function(t){var i=["err",C.VERSION,this.i.playId,C.userAgent,this.i.url,this.i.mediaType,this.i.uuid,t,this.i.bufferLength.toFixed(3),this.i.buffered,""];this.M(ot,this.L(dt,i))},wt.prototype.sendFB=function(){this.M(ot,this.L(at,["fb",C.VERSION,this.i.playId,C.userAgent,this.i.url,this.i.mediaType,this.i.uuid,this.i.firstBuffer,this.i.fileSize,this.i.lastModified]))},wt.prototype.sendDRAG=function(){var t=["db",C.VERSION,this.i.playId,C.userAgent,this.i.url,this.i.mediaType,this.i.uuid,this.i.seekPosition,this.i.seekType,this.i.seekCost,this.i.bufferLength.toFixed(3),this.i.playTime.toFixed(3),this.i.buffered];this.M(ot,this.L(ct,t))},wt.prototype.B=function(){this.x++,this.j.push(1e3*this.i.bufferLength),this._.push(this.i.speedCalc.calculate()),this.x%15==0&&this.W(),clearTimeout(this.C),this.C=setTimeout(this.B.bind(this),1e3)},wt.prototype.W=function(){this.x=0;var t=this.i.cdnBytes-this.G,i=this.i.bkjBytes-this.F;t<0&&(t=0),i<0&&(i=0);var s=Date.now();if(this.D){var n=s-Math.max(this.A,this.R);this.i.interruptTime+=Math.min(n,15e3)}var h=this.i.interruptCount-this.U,e=this.i.interruptTime-this.P;this.U=this.i.interruptCount,this.P=this.i.interruptTime,this.G=this.i.cdnBytes,this.F=this.i.bkjBytes,this.R=s,0===this.j.length&&this.j.push(1e3*this.i.bufferLength);var r=this.K(),u=this.V(r);this.j=[],0===this._.length&&this._.push(this.i.speedCalc.calculate());var o=this.X();this._=[];var f={};0<this.I.length&&(f.beq=this.I),0<this.N.length&&(f.bfq=this.N),0<this.i.requestQueue.length&&(f.rqq=this.i.requestQueue);var a=JSON.stringify(f);if(this.I=[],this.N=[],this.i.requestQueue=[],!this.i.isMediaPaused&&!this.i.isMediaEnded||t+i!==0){var c=[C.VERSION,this.i.playId,C.userAgent,this.i.url,this.i.mediaType,this.i.uuid,e,h,t,i,this.i.playTime.toFixed(3),r,u,this.i.peerRatio,a,o,this.i.buffered,this.i.fileSize,this.i.duration],l=this.L(lt,c);this.M(ft,l)}},wt.prototype.M=function(t,i){var s=new c.XMLHttpRequest;s.open("POST",t,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.send(i)},wt.prototype.L=function(t,i){for(var s=[],n=0;n<t.length;n++)s.push(t[n]+"="+encodeURIComponent(i[n]));return""+s.join("&")},wt.prototype.K=function(){var t=this.j.length;if(0===t)return 0;var i=0;return this.j.forEach(function(t){i+=t}),Math.floor(i/t)},wt.prototype.V=function(i){var t=this.j.length;if(0===t)return 0;var s=0;return this.j.forEach(function(t){s+=Math.abs(t-i)*Math.abs(t-i)}),Math.floor(Math.sqrt(s/t))},wt.prototype.X=function(){var t=this._.length;if(0===t)return 0;var i=0;return this._.forEach(function(t){i+=t}),Math.floor(i/t)},wt);function wt(t){Jt(this,wt),this.i=t,this.C=-1,this.x=0,this.P=0,this.U=0,this.G=0,this.F=0,this.D=!1,this.R=0,this.A=0,this.S=0,this.j=[],this._=[],this.I=[],this.N=[],n.ErrorHook=this.sendERR.bind(this)}var pt=(gt.prototype.dispose=function(){this.i=null,this.$&&(this.$.stopInterval(),this.$=null),this.Q(),this.H=null,this.Y&&(this.Y.waiting=null,this.Y.seeking=null,this.Y.seeked=null,this.Y.loadeddata=null,this.Y.playing=null,this.Y.error=null,this.Y.canplay=null)},gt.prototype.z=function(){this.H&&(this.H.addEventListener("waiting",this.Y.waiting),this.H.addEventListener("seeking",this.Y.seeking),this.H.addEventListener("seeked",this.Y.seeked),this.H.addEventListener("loadeddata",this.Y.loadeddata),this.H.addEventListener("playing",this.Y.playing),this.H.addEventListener("error",this.Y.error),this.H.addEventListener("canplay",this.Y.canplay))},gt.prototype.Q=function(){this.H&&(this.H.removeEventListener("waiting",this.Y.waiting),this.H.removeEventListener("seeking",this.Y.seeking),this.H.removeEventListener("seeked",this.Y.seeked),this.H.removeEventListener("loadeddata",this.Y.loadeddata),this.H.removeEventListener("playing",this.Y.playing),this.H.removeEventListener("error",this.Y.error),this.H.removeEventListener("canplay",this.Y.canplay))},gt.prototype.J=function(){null!==this.$&&(this.H.seeking||this.q||(this.q=!0,this.$.onBufferEmpty(Date.now())))},gt.prototype.Z=function(){null!==this.$&&this.q&&(this.q=!1,this.$.onBufferFull(Date.now()))},gt.prototype.tt=function(){null!==this.$&&(0===this.H.currentTime||this.it||(this.it=!0,this.st=Date.now(),this.i.seekSecond=this.H.currentTime,this.i.seekType=this.i.isBuffered(this.H.currentTime)?1:2))},gt.prototype.nt=function(){null!==this.$&&this.it&&(this.it=!1,this.i.seekPosition=this.i.reserveRg.position,this.i.seekCost=Date.now()-this.st,2===this.i.seekType&&this.$.sendDRAG())},gt.prototype.ht=function(){null!==this.$&&(this.i.firstBuffer=Date.now()-this.i.openTick,this.$.sendFB())},gt.prototype.et=function(){null!==this.$&&n.ERROR(this,"MeidaError: "+this.H.error.code)},gt.prototype.rt=function(){null!==this.$&&this.q&&(this.q=!1,this.$.onBufferFull(Date.now()))},gt);function gt(t){Jt(this,gt),this.i=t,this.H=this.i.mediaElement,this.it=!1,this.q=!1,this.st=0,this.Y={waiting:this.J.bind(this),seeking:this.tt.bind(this),seeked:this.nt.bind(this),loadeddata:this.ht.bind(this),playing:this.Z.bind(this),error:this.et.bind(this),canplay:this.rt.bind(this)},this.z(),this.$=new vt(this.i),this.$.startInterval()}var bt=(yt.prototype.ut=function(){var t=this;this.ot=setTimeout(function(){t.ot=-1,"function"==typeof t.ft&&t.ft()},this.at)},yt.prototype.cancel=function(){clearTimeout(this.ot),this.ot=-1},Ht(yt,[{key:"isActive",get:function(){return-1!==this.ot}}]),yt);function yt(t,i){Jt(this,yt),this.at=t,this.ft=i,this.ot=-1,this.ut()}var mt=C.http+"://seeds-open.xycdn.com/api/get_seeds",kt=(Et.prototype.dispose=function(){this.onTrackerResp=null,this.i=null,this.lt=!0,this.dt&&(this.dt.cancel(),this.dt=null)},Et.prototype.stop=function(){this.lt=!0},Et.prototype.start=function(){this.lt=!1,this.dt&&this.dt.isActive||this.vt()},Et.prototype.vt=function(){var s=this;if(!this.lt&&!this.pt){this.dt=new bt(1e4,this.vt.bind(this));var t={id:this.i.playId,url:this.i.url,client_type:1,verison:C.VERSION,peer_status:this.gt()};this.pt=!0,c.fetch(mt,{method:"POST",body:JSON.stringify(t),mode:"cors"}).then(function(t){if(200!==t.status)throw new TypeError("Unexpect Http StatusCode "+t.status);return t.json()}).then(function(t){if(1!==t.result_code)throw new TypeError("Unexpect ResultCode "+t.result_code);if(s.i){var i=[];t.data&&t.data.peers&&t.data.peers.forEach(function(t){i.push({hostname:t.peer_id,url:t.request_url,type:"bkj"})}),s.bt(null,i)}})["catch"](function(t){s.bt(t)})}},Et.prototype.bt=function(t,i){this.pt=!1,null!==t?n.ERROR(this,t.name+": "+t.message):this.onTrackerResp&&this.onTrackerResp(i)},Et.prototype.gt=function(){var s=this,n=[];return this.i.pipeManager.forEach(function(t){var i=0;t.state!==X&&"IDLE"!==t.state||(i=1),i="REQUESTED"===t.state||"LOADING"===t.state?2:t.client.lastQuality,n.push({peer_id:t.hostname,traffic:t.client.recvBytesDiffer(),period:t.client.downloadTimeDiffer(),status:i,reason:t.client.closeReason}),"CLOSED"===t.state&&s.i.pipeManager.remove(t.hostname)}),n},Et);function Et(t){Jt(this,Et),this.onTrackerResp=null,this.i=t,this.pt=!1,this.lt=!0,this.dt=null}var Ot=(Tt.prototype.toString=function(){return"["+this.yt+"] waiting: "+this.mt.length+", open: "+this.kt.length},Ht(Tt,[{key:"type",get:function(){return this.yt}},{key:"length",get:function(){return this.mt.length+this.kt.length}},{key:"waitingPipes",get:function(){return this.mt}},{key:"openPipes",get:function(){return this.kt}}]),Tt);function Tt(t){Jt(this,Tt),this.yt=t,this.mt=[],this.kt=[]}var Dt=(St.prototype.dispose=function(){clearTimeout(this.Et),this.Et=-1,this.Ot=0,this.i.pipeManager.forEach(function(t){return t.close()}),this.i=null},St.prototype.start=function(){this.Et=setTimeout(this.Tt.bind(this),100),this.Ot=0},St.prototype.stop=function(){clearTimeout(this.Et),this.Et=-1},St.prototype.Tt=function(){null!==this.i&&(this.Ot+=1,0<this.i.pipeManager.size()&&this.Dt(),clearTimeout(this.Et),this.Et=setTimeout(this.Tt.bind(this),100))},St.prototype.Dt=function(){this.Ot%2==0?this.St():this.At()},St.prototype.At=function(){var n=this,h=Date.now();this.i.pipeManager.forEach(function(t){if(t.state!==X)if("REQUESTED"===t.state){var i=t.client.requestTick;0<i&&n.i.requestTimeout<=h-i&&t.close(7)}else if("LOADING"===t.state){var s=t.client.receiveTick;0<s&&n.i.receiveTimeout<=h-s&&t.close(104)}})},St.prototype.St=function(){var i=new Ot("bkj");if(this.i.pipeManager.forEach(function(t){t.state===X?i.waitingPipes.push(t):"CLOSED"!==t.state&&i.openPipes.push(t)}),0!==i.waitingPipes.length&&!(C.MAX_BKJ_NUM<=i.openPipes.length))for(var t=0;i.openPipes.length+t<C.MAX_BKJ_NUM;)i.waitingPipes[t].preflight(),t+=1},Ht(St,[{key:"isReady",get:function(){return 0<this.i.pipeManager.idlePipes().length}}]),St);function St(t){Jt(this,St),this.i=t,this.Et=-1,this.Ot=0}var At=(Rt.prototype.addListener=function(t,i){if("function"!=typeof i)throw new Error("callback must be a function");this.Rt[t]||(this.Rt[t]=[]),this.Rt[t].push(i)},Rt.prototype.emit=function(t){if(t===undefined||null===t)throw new Error("need Event name!");var i=this.Rt[t];if(i)if(1===i.length){var s=i[0];switch(arguments.length){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:s.apply(this,Array.prototype.slice.call(arguments,1))}}else for(var n=0;n<i.length;n++)i[n].apply(this,Array.prototype.slice.call(arguments,1))},Rt.prototype.removeListener=function(t,i){if("function"!=typeof i)throw new Error("callback must be a function");var s=this.Rt[t];s&&(s.splice(s.indexOf(i),1),0===s.length&&delete this.Rt[t])},Rt.prototype.removeAllListeners=function(t){var i=this;t?delete this.Rt[t]:Object.keys(this.Rt).forEach(function(t){return delete i.Rt[t]})},Rt.prototype.on=function(t,i){this.addListener(t,i)},Rt.prototype.off=function(t,i){t?i?this.removeListener(t,i):this.removeAllListeners(t):this.removeAllListeners()},Rt);function Rt(){Jt(this,Rt),this.Rt={}}var Nt=0,It=(Ct.prototype.request=function(t,i,s){var n=this,h={method:"GET",mode:"cors",redirect:"follow"};i&&(h.headers=i),s&&(h.credentials="include"),"function"==typeof c.AbortController&&(this.Nt=new c.AbortController,h.signal=this.Nt.signal),c.fetch(t,h).then(function(t){if(n.It=t.body.getReader(),n.Ct)n.Bt();else{if(t.status<200||299<t.status)throw new w("Unexpect status code: "+t.status,t.status);if(n.onHeaders){var s={};t.headers.forEach(function(t,i){s[i]=t}),n.onHeaders(s)}n.Wt()}})["catch"](function(t){n.Mt(t)})},Ct.prototype.abort=function(){this.Nt?this.Nt.abort():(this.Ct=!0,this.Bt())},Ct.prototype.Bt=function(){null!==this.It&&this.It.cancel()["catch"](function(t){})},Ct.prototype.Mt=function(t){"Failed to fetch"!==t.message&&"network error"!==t.message||(t=new b(t.message)),this.onError&&this.onError(t)},Ct.prototype.Wt=function(){var s=this;this.It.read().then(function(t){var i=t.value;t.done?s.onEnd&&s.onEnd():(s.onData&&s.onData(i),s.Wt())})["catch"](function(t){s.Mt(t)})},Ct);function Ct(){Jt(this,Ct),this.onHeaders=null,this.onData=null,this.onEnd=null,this.onError=null,this.It=null,this.Ct=!1,this.Nt=null}var Bt=(Wt.prototype.request=function(t,i,s){var n=this;this.Lt=new c.XMLHttpRequest,this.Lt.open("GET",t,!0),i&&Object.keys(i).forEach(function(t){n.Lt.setRequestHeader(t,i[t])}),this.Lt.responseType="moz-chunked-arraybuffer",s&&(this.Lt.withCredentials=!0),this.Lt.onreadystatechange=this.xt.bind(this),this.Lt.onprogress=this.jt.bind(this),this.Lt.onerror=this.et.bind(this),this.Lt.onload=this._t.bind(this),this.Lt.send()},Wt.prototype.abort=function(){this.Lt&&(this.Lt.onreadystatechange=null,this.Lt.onprogress=null,this.Lt.onerror=null,this.Lt.onload=null,this.Lt.abort(),this.Lt=null)},Wt.prototype.xt=function(){if(2===this.Lt.readyState){if(this.Lt.status<200||299<this.Lt.status){var t=new w("Unexpect status code: "+this.Lt.status,this.Lt.status);return void(this.onError&&this.onError(t))}if(this.onHeaders){var h={};this.Lt.getAllResponseHeaders().split(/\r?\n/).forEach(function(t){var i=t.split(":"),s=i.shift().trim();if(s){var n=i.join(":").trim();h[s]=n}}),this.onHeaders(h)}}},Wt.prototype.jt=function(){this.onData&&this.onData(new Uint8Array(this.Lt.response))},Wt.prototype._t=function(){this.onEnd&&this.onEnd()},Wt.prototype.et=function(){var t=new b("XHR error");this.onError&&this.onError(t)},Wt);function Wt(){Jt(this,Wt),this.onHeaders=null,this.onData=null,this.onEnd=null,this.onError=null,this.Lt=null}var Mt,Lt=function Lt(t){var i=C.RANGE_REGEX.exec(t);return{start:Number.parseInt(i[1],10),end:Number.parseInt(i[2],10),fileSize:Number.parseInt(i[3],10)}},xt=(zt(jt,Mt=At),jt.prototype.open=function(){X===this.Gt&&(this.Gt="IDLE")},jt.prototype.preflight=function(){var i=this;if(X===this.Gt){this.Gt="CHECKING";var t=this.i.downloadRgq,s=0===t.ranges.length?this.i.reserveRg.position:t.end,n=new c.XMLHttpRequest;n.timeout=this.i.preflightTimeout,n.onerror=function(){i.close(8)},n.ontimeout=function(){i.close(9)},n.onload=function(){var t=Lt(n.getResponseHeader("Content-Range"));"bkj"===i.type&&i.i.fileSize!==t.fileSize?i.close(6):i.Gt="IDLE"},n.open("GET",this.Ft.url,!0),n.setRequestHeader("Range","bytes="+s+"-"+s),n.send(),this.Ut=n}},jt.prototype.request=function(t,i){"IDLE"===this.Gt&&(this.Pt="firefox"===C.browser.name&&C.browser.version.major<68?new Bt:new It,this.Pt.onHeaders=this.Kt.bind(this),this.Pt.onData=this.Vt.bind(this),this.Pt.onEnd=this.Xt.bind(this),this.Pt.onError=this.et.bind(this),this.r=t,this.h=0<i?t+i-1:"",this.Pt.request(this.Ft.url,{Range:"bytes="+this.r+"-"+this.h},this.i.withCredentials),this.Gt="REQUESTED",this.i.currentPipe=this.hostname+": "+this.r+"-"+this.h,this.i.currentUrl=this.Ft.url,this.i.requestQueue.push({id:this.hostname,rr:this.i.reserveRg.position+"-"+(this.i.reserveRg.end-1),rg:this.r+"-"+this.h,ct:this.i.playTime.toFixed(3),bf:this.i.buffered}),this.$t.onRequestData(t,i))},jt.prototype.abort=function(){null!==this.Pt&&(this.Pt.abort(),this.Pt.onHeaders=null,this.Pt.onData=null,this.Pt.onEnd=null,this.Pt.onError=null,this.Pt=null,this.Gt="IDLE")},jt.prototype.close=function(){var t=0<arguments.length&&arguments[0]!==undefined?arguments[0]:0;"CLOSED"!==this.Gt&&("CHECKING"===this.Gt&&this.Ut.abort(),this.Pt&&(this.Pt.abort(),this.Pt.onHeaders=null,this.Pt.onData=null,this.Pt.onEnd=null,this.Pt.onError=null,this.Pt=null),this.Gt="CLOSED",this.$t.onClose(t),this.emit(Nt,2,{target:this}),this.off(),6!==t&&8!==t&&9!==t||this.i.blackPipeList.set(this.hostname,this))},jt.prototype.Kt=function(t){this.Gt="LOADING";var i,s=0;if(t["content-range"]!==undefined?s=Lt(t["content-range"]).fileSize:t["content-length"]!==undefined&&0===this.i.reserveRg.length&&(s=this.i.reserveRg.position+Number.parseInt(t["content-length"],10)),"bkj"!==this.type){var n=0;if(t["last-modified"]!==undefined){var h=Date.parse(t["last-modified"])/1e3;if(i=h,!(Number.isInteger?Number.isInteger(i):"number"==typeof i&&i%1==0)){var e=(new Date).getTimezoneOffset();h=Date.parse(/.*\d/.exec(t["last-modified"])[0])/1e3-60*e}n=h}this.emit(Nt,11,{fileSize:s,lastModified:n,target:this})}},jt.prototype.Vt=function(t){var i=this.r;this.r=i+t.length,this.$t.onReceiveData(i,t.length),this.emit(Nt,9,{buffer:t,offset:i,target:this})},jt.prototype.Xt=function(){this.Gt="IDLE",this.$t.onReceiveEnd(),this.emit(Nt,10,{target:this})},jt.prototype.et=function(t){var i=0;"REQUESTED"===this.Gt?i=101:"LOADING"===this.Gt&&(i=100),this.emit(Nt,6,{error:t,reason:i,target:this})},Ht(jt,[{key:"type",get:function(){return this.Ft.type}},{key:"hostname",get:function(){return this.Ft.hostname}},{key:"state",get:function(){return this.Gt}},{key:"client",get:function(){return this.$t}}]),jt);function jt(t,i){Jt(this,jt);var s=Yt(this,Mt.call(this));return s.Ft=t,s.Gt=X,s.i=i,s.r=0,s.h=0,s.Ut=null,s.Pt=null,s.$t=new H(s),s}var _t=C.http+"://conf-darwin.xycdn.com/psdk_param?version=hd_"+C.RELEASE_VERSION,Gt=(Ft.prototype.dispose=function(){this.onData=null,this.onEnd=null,this.onError=null,this.lt=!0,this.Qt=!1,this.Ht=!1,this.Yt=null,clearTimeout(this.Et),this.Et=-1,clearTimeout(this.zt),this.zt=-1,this.Jt&&(this.Jt.dispose(),this.Jt=null),this.qt&&(this.qt.dispose(),this.qt=null),this.Zt&&(this.Zt.close(),this.Zt=null),this.i=null},Ft.prototype.open=function(t,i){if(this.lt){this.lt=!1,this.qt.start(),this.Jt.start(),i<0&&(i=0),0<this.i.fileSize&&(0===i||this.i.fileSize<t+i)&&(i=this.i.fileSize-t),this.i.reserveRg=new G(t,i);var s=this.i.bufferLength;this.i.downloadRgq.clear(),this.i.sendPos=t,this.Zt.open(),this.i.bufferLimit<=s&&this.Jt.isReady?this.ti():this.ii(),clearTimeout(this.Et),this.Et=setTimeout(this.Tt.bind(this),100)}},Ft.prototype.close=function(){this.lt||(this.lt=!0,this.Qt=!1,this.Ht=!1,clearTimeout(this.Et),this.Et=-1,clearTimeout(this.zt),this.zt=-1,this.qt.stop(),this.Jt.stop(),this.Zt.abort(),this.i.pipeManager.forEach(function(t){return t.abort()}))},Ft.prototype.si=function(){var i=this;c.fetch(_t,{method:"GET",mode:"cors",headers:{Accept:"application/json"}}).then(function(t){if(200!==t.status)throw new TypeError("Unexpect Http StatusCode "+t.status);return t.json()}).then(function(t){null!==i.i&&(m(t.bufferLimit)&&C.MIN_BUFFER_LIMIT<t.bufferLimit&&(i.i.bufferLimit=t.bufferLimit),m(t.bufferFallback)&&C.MIN_BUFFER_FALLBACK<t.bufferFallback&&(i.i.bufferFallback=t.bufferFallback),m(t.requestTimeout)&&C.MIN_REQUEST_TIMEOUT<t.requestTimeout&&(i.i.requestTimeout=t.requestTimeout),m(t.receiveTimeout)&&C.MIN_RECEIVE_TIMEOUT<t.receiveTimeout&&(i.i.receiveTimeout=t.receiveTimeout),m(t.preflightTimeout)&&C.MIN_PREFLIGHT_TEIMOUT<t.preflightTimeout&&(i.i.preflightTimeout=t.preflightTimeout),m(t.suspendRangeLength)&&C.MIN_SUSPEND_RANGE_LENGTH<t.suspendRangeLength&&(i.i.suspendRangeLength=t.suspendRangeLength),m(t.abnormalCloseLimit)&&C.MIN_ABNORMAL_CLOSE_LIMIT<t.abnormalCloseLimit&&(i.i.abnormalCloseLimit=t.abnormalCloseLimit))})["catch"](function(t){n.ERROR(i,"loadConfig failed, "+t.name+": "+t.message)})},Ft.prototype.Tt=function(){if(!this.lt){if(this.Zt&&"LOADING"===this.Zt.state){var t=this.Zt.client.receiveTick;0<t&&5e3<Date.now()-t&&this.Zt.abort()}this.ni(),clearTimeout(this.Et),this.Et=setTimeout(this.Tt.bind(this),100)}},Ft.prototype.hi=function(){var t=this;null===this.Zt||"IDLE"===this.Zt.state||0===this.i.sendPos||this.Qt||!1===this.Jt.isReady||this.i.bufferLength<this.i.bufferLimit||(this.Qt=!0,this.zt=setTimeout(function(){t.Qt=!1,t.Zt.abort()},0))},Ft.prototype.ni=function(){if(!(this.lt||this.Zt&&"IDLE"!==this.Zt.state)){var t=this.i.bufferLength;Math.round(this.i.speedCalc.calculate()),t<this.i.bufferFallback||this.Ht?(this.Ht=!1,this.ii()):this.ti()}},Ft.prototype.ii=function(){this.i.pipeManager.forEach(function(t){return t.abort()});var t=this.i.downloadRgq,i=0===t.ranges.length?this.i.reserveRg.position:t.end;0<this.i.reserveRg.length&&this.i.reserveRg.end<=i||this.Zt.request(i,this.i.reserveRg.end-i)},Ft.prototype.ti=function(){this.i.pipeManager.forEach(this.ei.bind(this))},Ft.prototype.ei=function(t){if("IDLE"===t.state){var i=this.i.downloadRgq,s=0===i.ranges.length?this.i.reserveRg.position:i.end;0<this.i.reserveRg.length&&this.i.reserveRg.end<=s||t.request(s,this.i.reserveRg.end-s)}},Ft.prototype.bt=function(t){var s=this;t.forEach(function(t){if(!s.i.pipeManager.has(t.hostname)&&!s.i.blackPipeList.has(t.hostname)){var i=new xt(t,s.i);i.on(Nt,s.ri.bind(s)),s.i.pipeManager.set(t.hostname,i)}})},Ft.prototype.ri=function(t,i){if(!this.lt)switch(t){case 9:this.ui(i);break;case 10:this.oi(i);break;case 11:this.fi(i);break;case 2:this.ai(i);break;case 6:this.ci(i)}},Ft.prototype.fi=function(t){0===this.i.fileSize&&(this.i.fileSize=t.fileSize,this.i.lastModified=t.lastModified,(0===this.i.reserveRg.length||t.fileSize<this.i.reserveRg.end)&&this.i.reserveRg.assign(this.i.reserveRg.position,t.fileSize-this.i.reserveRg.position))},Ft.prototype.ui=function(t){var i=new G(t.offset,t.buffer.length),s=t.target;this.i.speedCalc.addBytes(i.length),s.type===$?(this.i.cdnSpeedCalc.addBytes(i.length),this.i.cdnBytes+=i.length):"bkj"===s.type&&(this.i.p2pSpeedCalc.addBytes(i.length),this.i.bkjBytes+=i.length),this.i.downloadRgq.addRange(i),$===s.type&&this.i.suspendRangeLength<this.i.reserveRg.length&&this.hi(),this.i.sendPos=i.end,this.onData&&this.onData(t.buffer,t.offset)},Ft.prototype.oi=function(t){0<this.i.sendPos&&this.i.sendPos===this.i.reserveRg.end&&this.onEnd&&this.onEnd()},Ft.prototype.ai=function(t){var i=t.target;0!==i.client.closeReason&&(this.Ht=!0,this.Yt[i.hostname]=(this.Yt[i.hostname]||0)+1,this.i.abnormalCloseLimit<=this.Yt[i.hostname]&&this.i.blackPipeList.set(i.hostname,i))},Ft.prototype.ci=function(t){var i=t.target,s=t.reason,n=t.error;if(i.type===$){i.abort();var h={status:n.status?n.status:0,message:n.toString()};this.onError&&this.onError(h)}else i.close(s)},Ft);function Ft(t){Jt(this,Ft),this.onData=null,this.onEnd=null,this.onError=null,this.i=t,this.qt=new kt(this.i),this.qt.onTrackerResp=this.bt.bind(this),this.Jt=new Dt(this.i),this.Et=-1,this.zt=-1,this.lt=!0,this.Qt=!1,this.Ht=!1,this.Yt={},this.si(),this.Zt=new xt({hostname:"cdn",url:this.i.url,type:$},this.i),this.Zt.on(Nt,this.ri.bind(this))}var Ut,Pt="closed",Kt={DATA:"data",END:"end",ERROR:"error"},Vt=(zt(Xt,Ut=At),Xt.isSupported=function(){return(C.isFetchStreamSupported||C.isMozChunkedSupported)&&C.isTypedArraySupported&&C.isSessionStorageSupported},Xt.version=function(){return C.VERSION},Xt.prototype.open=function(t){var i=1<arguments.length&&arguments[1]!==undefined?arguments[1]:-1;if(this.readyState!==Pt)throw new Error("Failed to execute 'open' on 'XYVOD': The object's state must be CLOSED.");this.readyState="opened",this.i.openTick=Date.now(),this.li.open(t,-1<i?i-t+1:0)},Xt.prototype.close=function(){if("opened"!==this.readyState)throw new Error("Failed to execute 'close' on 'XYVOD': The object's state must be OPENED.");this.readyState=Pt,this.li.close()},Xt.prototype.dispose=function(){this.readyState="disposed",this.off(),this.li&&(this.li.dispose(),this.li=null),this.di&&(this.di.dispose(),this.di=null),this.i&&(this.i.dispose(),this.i=null),c.xyctl&&(c.xyctl.getInfo=null)},Ht(Xt,[{key:"options",set:function(t){t.withCredentials!==undefined&&(this.i.withCredentials=!!t.withCredentials)}},{key:"info",get:function(){return this.i?{cdnBytes:this.i.cdnBytes,p2pBytes:this.i.bkjBytes,currentUrl:this.i.currentUrl}:{cdnBytes:0,p2pBytes:0}}}]),Xt);function Xt(t){if(Jt(this,Xt),!t)throw new l("XYVOD constructor, expect options");if(!t.url)throw new l("XYVOD constructor, expect options.url");if(!t.media&&!t.video&&!t.audio)throw new l("XYVOD constructor, expect options.mediaElement");var s=Yt(this,Ut.call(this));return s.i=new rt(t),s.di=new pt(s.i),s.li=new Gt(s.i),s.li.onData=function(t,i){s.emit(Kt.DATA,{buffer:t.buffer,offset:i})},s.li.onEnd=function(){s.close();var t=s.i.reserveRg;s.emit(Kt.END,{start:t.position,end:t.end})},s.li.onError=function(t){s.close(),s.emit(Kt.ERROR,t)},s.readyState=Pt,c.xyctl&&(c.xyctl.getInfo=function(){return{version:C.VERSION,playId:s.i.playId,fileSize:s.i.fileSize+"(B)",mediaDuration:s.i.duration+"(s)",downloadSpeed:k(s.i.speedCalc.calculate()/1024)+"(KB/s)",firstBuffer:s.i.firstBuffer+"(ms)",interruptCount:s.i.interruptCount,interruptTime:s.i.interruptTime+"(ms)",bufferLength:s.i.bufferLength+"(s)",played:s.i.played,buffered:s.i.buffered,downloadRgq:s.i.downloadRgq.toString(),reserveRg:s.i.reserveRg.toString(),playTime:s.i.playTime+"(s)",cdnBytes:s.i.cdnBytes+"(B)",bkjBytes:s.i.bkjBytes+"(B)",peerRatio:s.i.peerRatio+"%",pipes:s.i.pipes,currentUrl:s.i.currentUrl}}),s}var $t=(Qt.prototype.load=function(t,i){if(null!=this.vi){var s=t.from,n=t.to;this.vi.options={withCredentials:i},this.vi.readyState!==Pt&&this.vi.close(),this.vi.open(s,n)}},Qt.prototype.abort=function(){null!=this.vi&&"opened"===this.vi.readyState&&this.vi.close()},Qt.prototype.destroy=function(){null!=this.vi&&(this.vi.dispose(),this.vi=null,this.onDataArrival=null,this.onComplete=null,this.onError=null)},Qt.prototype.loadInfo=function(){if(null==this.vi)return null;var t=this.vi.info;return{cdn:t.cdnBytes,p2p:t.p2pBytes,url:t.currentUrl}},Qt);function Qt(t,i,s){var n=this;Jt(this,Qt),this.onDataArrival=null,this.onComplete=null,this.onError=null,this.vi=new Vt({url:t,media:i,mediaType:s}),this.vi.on(Kt.DATA,function(t){var i=t.offset;n.onDataArrival&&n.onDataArrival(new Uint8Array(t.buffer),i)}),this.vi.on(Kt.END,function(t){n.onComplete&&n.onComplete()}),this.vi.on(Kt.ERROR,function(t){n.onError&&n.onError(t.status,t.message)})}return t.Loader=$t,t.XYVOD=Vt,t.XYVODEvent=Kt,t}({});