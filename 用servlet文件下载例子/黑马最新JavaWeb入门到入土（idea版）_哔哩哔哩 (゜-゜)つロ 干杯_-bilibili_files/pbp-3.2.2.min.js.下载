/*!
 * pbp | v3.2.2
 * 3/24/2020, 4:26:43 PM
 * wushiyang <wushiyang@bilibili.com>, lipengcheng <lipengcheng@bilibili.com>, tangjunxing <tangjunxing@bilibili.com>
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).BiliPBP=t()}(this,function(){"use strict";function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function e(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e}function r(l){return new Promise(function e(t,i){if(l.url){var a=new XMLHttpRequest;l.pending&&(l.pending.xhr=a);var r=l.url;if(l.params){var n=Object.keys(l.params).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(l.params[e])}).join("&");if(!(r=function(e,t){var i=e.split("?");if(2===i.length)i[1]?e+="&"+t:e+=t;else{if(1!==i.length)return"";e+="?"+t}return e}(r,n)))return void i(new Error("xhr url parse error"))}for(var o in l.method||(l.method="GET"),a.open(l.method.toUpperCase(),r,!0),l.withCredentials&&(a.withCredentials=!0),l.responseType?a.responseText=l.responseType:a.responseType="text",a.onreadystatechange=function(){4===a.readyState&&(200<=a.status&&a.status<300?t(function(e,t){if("json"===t){var i,a=e.responseText;try{i=JSON.parse(a)}catch(e){i={}}return i}}(a,"json")):l.retry&&"number"==typeof l.retry&&!l.pending.manualPause?(l.retry-=1,function(a){return new Promise(function(e,t){var i=setTimeout(e,2e3);a.stopTimer=function(){clearInterval(i),i=null,a.stopTimer=null,t(new Error("stop timer"))}})}(l.pending).then(function(){l.retryFunction&&"function"==typeof l.retryFunction&&l.retryFunction(),e(t,i)}).catch(i)):i({http_url:r,http_method:l.method,http_status:a.status}))},l.headers)Object.prototype.hasOwnProperty.call(l,o)&&a.setRequestHeader(o,l.headers[o]);"object"===s(l.data)&&(a.setRequestHeader("Content-Type","application/json; charset=UTF-8"),l.data=JSON.stringify(l.data)),a.send(l.data||null)}else i(new Error("xhr url missing"))})}var n=function(e,t,i,a){return r({url:"//".concat(i||"api.bilibili.com","/pbp/data?cid=").concat(t,"&version=").concat(a),method:"get",withCredentials:!0})},o=function(){function t(e){i(this,t),this.isRunning=!1,this.recIsFirst=!0,this.recHasOpen=!1,this.recListFooterWatcher=null,this.debug=!1}return e(t,[{key:"_init",value:function(){var a=this;if(window.$pbp&&window.$pbp.aid){var e,t,r;window.recLoader&&this.recIsFirst&&(window.recLoader=this),NodeList.prototype.forEach=Array.prototype.forEach;var n=location.href.indexOf("/av");if(-1===n){if(!(e=document.getElementById("recom_module")))return;t=e.querySelector(".recom-list"),r=t.querySelectorAll(".recom-item")}else{if(!(e=document.getElementById("reco_list")))return;t=e.querySelector(".rec-list"),r=t.querySelectorAll(".video-page-card")}this.recIsFirst&&(this.recListFooterWatcher=new MutationObserver(function(){a.isRunning=!0,setTimeout(a._init.bind(window.recLoader),0)}),this.recListFooterWatcher.observe(t,{childList:!0,subtree:!1})),r.forEach(function(e,t,i){a.recIsFirst||20===r.length?-1===n?a._recListLoadDrawer(e.querySelector(".cover-wrapper"),e.querySelector("a")?e.querySelector("a").href:null):a._recListLoadDrawer(e.querySelector(".pic")):19<t&&(-1===n?a._recListLoadDrawer(e.querySelector(".cover-wrapper"),e.querySelector("a")?e.querySelector("a").href:null):a._recListLoadDrawer(e.querySelector(".pic"))),!e.nextElementSibling&&a.recIsFirst?a.recIsFirst=!1:e.nextElementSibling||(a.recHasOpen=!0)}),setTimeout(function(){a.isRunning=!1},0)}}},{key:"_recListLoadDrawer",value:function(e,t){if(e&&!e.querySelector(".rec-list-item-load")){var i,a=-1===location.href.indexOf("/av")?t:e.querySelector("a").href,r=a.slice(a.indexOf("/av")+3,-1===location.href.indexOf("/av")?a.lastIndexOf("/"):a.indexOf("?")-1);if(a){var n=[];try{var o=window.wsLocalStorage.get("pbp_rec_loader_"+r);o&&(n=JSON.parse(window.wsLocalStorage.get("pbp_zebra_cache_"+o)))}catch(e){return}finally{if(null==n||0===n.length)return;if(0===(i=n[n.length-1][1]))return;window.BiliPBP.prototype._debugLog.call(this,r+"Injected");var l=document.createElement("div");l.setAttribute("class","rec-list-item-load"),l.style.background="gray",l.style.display="block",l.style.position="absolute",l.style.top="76px",l.style.width="100%",l.style.height="4px",l.style.zIndex="2";var s=document.createElement("span");s.setAttribute("class","rec-list-item-loaded"),s.style.background="#fb7299",s.style.position="absolute",s.style.height="4px",s.style.width=100*i+"%",l.appendChild(s),e.appendChild(l)}}}}}]),t}();function l(e,t){var i=localStorage.getItem(e);return null==i&&c(e,t),i||t}var t,p=(function(e,t){
/*!
      web-storage-cache -- Added `expires` attribute and serialize data with `JSON.parse` for the localStorage and sessionStorage.
      Version 1.1.1
      https://github.com/WQTeam/web-storage-cache
      (c) 2013-2016 WQTeam, MIT license
  */
e.exports=function(){function o(e,t){for(var i in t)e[i]=t[i];return e}function l(e){var t=!1;if(e&&e.setItem){t=!0;var i="__"+Math.round(1e7*Math.random());try{e.setItem(i,i),e.removeItem(i)}catch(e){t=!1}}return t}function s(e){var t=typeof e;return"string"===t&&window[e]instanceof Storage?window[e]:e}function p(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())}function a(e,t){if(t=t||new Date,"number"==typeof e?e=e===1/0?i:new Date(t.getTime()+1e3*e):"string"==typeof e&&(e=new Date(e)),e&&!p(e))throw new Error("`expires` parameter cannot be converted to a valid Date instance");return e}function n(e){var t=!1;if(e)if(e.code)switch(e.code){case 22:t=!0;break;case 1014:"NS_ERROR_DOM_QUOTA_REACHED"===e.name&&(t=!0)}else-2147024882===e.number&&(t=!0);return t}function c(e,t){this.c=(new Date).getTime(),t=t||u;var i=a(t);this.e=i.getTime(),this.v=e}function r(e){return"object"!=typeof e?!1:e&&"c"in e&&"e"in e&&"v"in e?!0:!1}function d(e){var t=(new Date).getTime();return t<e.e}function b(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function e(e){var t={storage:"localStorage",exp:1/0},i=o(t,e),a=i.exp;if(a&&"number"!=typeof a&&!p(a))throw new Error("Constructor `exp` parameter cannot be converted to a valid Date instance");u=a;var r=s(i.storage),n=l(r);this.isSupported=function(){return n},n?(this.storage=r,this.quotaExceedHandler=function(e,t,i){if(console.warn("Quota exceeded!"),i&&i.force===!0){var a=this.deleteAllExpires();console.warn("delete all expires CacheItem : ["+a+"] and try execute `set` method again!");try{i.force=!1,this.set(e,t,i)}catch(e){console.warn(e)}}}):o(this,g)}var i=new Date("Fri, 31 Dec 9999 23:59:59 UTC"),u=i,h={serialize:function(e){return JSON.stringify(e)},deserialize:function(e){return e&&JSON.parse(e)}},g={set:function(){},get:function(){},delete:function(){},deleteAllExpires:function(){},clear:function(){},add:function(){},replace:function(){},touch:function(){}},t;return e.prototype={set:function(t,e,i){if(t=b(t),"number"==typeof i&&(i={exp:i}),i=o({force:!0},i),void 0===e)return this["delete"](t);var a=h.serialize(e),r=new c(a,i.exp);try{this.storage.setItem(t,h.serialize(r))}catch(e){n(e)?this.quotaExceedHandler(t,a,i,e):console.error(e)}return e},get:function(e){e=b(e);var t=null;try{t=h.deserialize(this.storage.getItem(e))}catch(e){return null}if(r(t)){if(d(t)){var i=t.v;return h.deserialize(i)}this["delete"](e)}return null},delete:function(e){return e=b(e),this.storage.removeItem(e),e},deleteAllExpires:function(){for(var e=this.storage.length,t=[],i=this,a=0;e>a;a++){var r=this.storage.key(a),n=null;try{n=h.deserialize(this.storage.getItem(r))}catch(e){}if(null!==n&&void 0!==n.e){var o=(new Date).getTime();o>=n.e&&t.push(r)}}return t.forEach(function(e){i["delete"](e)}),t},clear:function(){this.storage.clear()},add:function(t,i,a){t=b(t),"number"==typeof a&&(a={exp:a}),a=o({force:!0},a);try{var e=h.deserialize(this.storage.getItem(t));if(!r(e)||!d(e))return this.set(t,i,a),!0}catch(e){return this.set(t,i,a),!0}return!1},replace:function(e,t,i){e=b(e);var a=null;try{a=h.deserialize(this.storage.getItem(e))}catch(e){return!1}if(r(a)){if(d(a))return this.set(e,t,i),!0;this["delete"](e)}return!1},touch:function(e,t){e=b(e);var i=null;try{i=h.deserialize(this.storage.getItem(e))}catch(e){return!1}if(r(i)){if(d(i))return this.set(e,this.get(e),{exp:t}),!0;this["delete"](e)}return!1}},e}()}(t={exports:{}},t.exports),t.exports),c=function(e,t){localStorage.setItem(e,t)},b="bilibili_pbp",d="bilibili_pbp_guide",u="bilibili_pbp_panel",h="bilibili_pbp_panel_style",g="bilibili-player-video-control",v="bilibili_pbp_pin",f=1e3,m="3.2.2",w={l:16,m:28,h:32},y={l:.5,m:.2,h:.1},_={b:{fillColor:"255,255,255",playedColor:"35,173,229"},p:{fillColor:"255,255,255",playedColor:"251,114,153"},r:{fillColor:"255,255,255",playedColor:"178,45,67"},g:{fillColor:"255,255,255",playedColor:"11,163,150"}};return function(){function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i(this,a),this.options=e,this._clearStore(),this._status="wait",this._pbptag={},this._pbptagstr=""}return e(a,null,[{key:"isSupport",value:function(){return!!(window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver)&&(!!Promise&&(!(!localStorage&&!sessionStorage)&&(window.wsLocalStorage=new p({storage:window.localStorage,exp:3600}),!0)))}},{key:"loadLab",value:function(e){e&&("undefined"!=typeof window&&window.player&&window.player.loadLab?window.player.loadLab(1):setTimeout(function(){a.loadLab(--e)},500))}}]),e(a,[{key:"init",value:function(e,t){var c=this,i=0<arguments.length&&void 0!==e?e:"default",d=1<arguments.length&&void 0!==t?t:function(){};if("destroy"===this._status&&(this._status="wait"),!a.isSupport())return this._debugLog("init unsupported"),this.destroy(),d(new Error("environment not support"));this.eventKey=this.pbpDebugKey||i||"default",this._debugLog("init key =",this.eventKey),this._injectBiliPlayer().then(function(){return"destroy"===c._status?(c.destroy(),d(new Error("_status destroy"))):(c._debugLog("injectBiliPlayer complete"),c.aid&&c.cid?c.options&&c.options.data&&0<Object.keys(c.options.data).length?new Promise(function(e,t){e(c.options.data)}):n(c.aid,c.cid,c.pbpDebugApi,m):d(new Error("aid || cid miss")))}).then(function(e){if("destroy"===c._status)return c.destroy(),d(new Error("_status destroy"));if(document.getElementById(b))return c.destroy(),d(new Error("old pbp not destroy"));if(c.video=document.querySelector("video"),!c.video)return c.destroy(),d(new Error("video element miss"));var t=e.step_sec,i=e.events,a=void 0===i?{}:i,r=e.tag,n=void 0===r?{}:r,o=e.tagstr,l=void 0===o?"":o,s=e.debug;c._pbptag=n,c._pbptagstr=l,c._debugLog("init api response debug: ",s);var p=a[c.eventKey];if(!p||!p.length||!t)return c.destroy(),c._debugLog("events[".concat(c.eventKey,"] length empty"),s),d(new Error("events[key] length empty"));c._debugLog("init async start: api.cidData complete",c.eventKey,p),c.st={name:c.eventKey,key:c.eventKey,points:c._calculatePercentage(p,t)},c._checkVersion(),c._recoverZebraDataFromCache(),c._initPanel(c.eventKey,a),d(null,c.st)}).catch(function(e){d?d(e):console.error(e),c._debugLog(e)})}},{key:"show",value:function(){var e=this;if("destroy"!==this._status&&"show"!==this._status&&this.st){this._status="show",this._debugLog("call show");var t=l("pbp_height_v3","m"),i=w[t]?w[t]:w.m,a=window.player.getPlayerState().gamePlayer?"-33":"3";this.pbpStyle=document.createElement("style"),this.pbpStyle.innerHTML="#bilibili_pbp{display:flex;cursor:pointer;position:absolute;bottom:".concat(a,"px;left:-12px;width:calc(100% + 24px);height:").concat(i,"px;opacity:0;z-index:0}#bilibili_pbp.show{bottom:calc(100% - 2px);opacity:1;left:0;width:100%}.webfullscreen #bilibili_pbp,.mode-fullscreen #bilibili_pbp{bottom:5px}.webfullscreen #bilibili_pbp.show,.bilibili-player.mode-fullscreen #bilibili_pbp.show{bottom:calc(100% + 4px + 1px)}.bui-thumb{z-index:1}.bilibili-player-video-toast-wrp{z-index:1000}.bui-slider .bui-track.bui-track-video-progress{height:4px !important;border-radius:0}.bui-slider .bui-track .bui-bar-wrap{border-radius:0}.bilibili-player-video-state{z-index:998}.video-control-show .subtitle-position.subtitle-position-bc{bottom:74px}.mode-fullscreen .video-control-show .subtitle-position.subtitle-position-bc{bottom:84px}.mode-webfullscreen .video-control-show .subtitle-position.subtitle-position-bc{bottom:84px}#bilibili_pbp.pin{opacity:1}.video-control-show .bilibili-player-video-interactive{margin-bottom:16px}.webfullscreen .bilibili-player-video-interactive,.mode-fullscreen .bilibili-player-video-interactive{margin-bottom:24px}#bilibili_pbp_pin{cursor:pointer;position:absolute;bottom:calc(100%);z-index:1;color:white;opacity:0;line-height:16px;text-align:center}.bilibili-player .bilibili-player-area.video-control-show #bilibili_pbp_pin,.bilibili-player .bilibili-player-area .bilibili-player-video-control-wrap:hover #bilibili_pbp_pin{right:-8px;opacity:1}.webfullscreen #bilibili_pbp_pin,.mode-fullscreen #bilibili_pbp_pin{bottom:calc(100% + 4px + 1px + 2px)}#bilibili_pbp.pin{opacity:1}.pbp-icon{width:16px;height:16px;background-size:contain;transform:rotate(45deg)}.pbp-icon:hover{transform:rotate(60deg) scale(1.2);transition:all .1s ease-in-out;-webkit-transition:all .1s ease-in-out}.pbp-tips{position:absolute;font-size:12px;color:#fff;border-radius:4px;line-height:18px;padding:4px 8px;background-color:#000;background:rgba(0,0,0,.8);white-space:nowrap;right:0;top:0;display:none}#bilibili_pbp_pin:hover .pbp-tips{top:-30px;display:block;transition:all .3 ease-in-out;-webkit-transition:all .3 ease-in-out}"),document.head.appendChild(this.pbpStyle),this._updatePbpConfig(),this._create(),this._refresh(),this._observerChange(),this._initPin(),this.debug&&setTimeout(function(){window.recLoader=new o,window.recLoader.MAX_SHOW=100,window.recLoader.debug=e.debug,window.recLoader._init()},500)}}},{key:"hide",value:function(){if("destroy"!==this._status&&"hide"!==this._status&&(this._status="hide",this._debugLog("call hide"),this.pbp))try{var e=document.getElementsByClassName(g)[0];e.removeChild(this.pbp);var t=document.getElementById(d);this.video&&this.video.removeEventListener("seeking",this.videoSeekingCallback),window.player&&(window.player.removeEventListener("video_controlbar",this.videoControlbarCallback),window.player.removeEventListener("video_heartbeat",this.videoHeartbeatCallback),window.player.removeEventListener("video_progress_update",this.videoProgressUpdateCallback)),this.pbpStyle&&document.head.removeChild(this.pbpStyle),this.themeStyle&&(document.head.removeChild(this.themeStyle),this.themeStyle=null),t&&e.removeChild(t);var i=document.getElementById(v);i&&e.removeChild(i)}catch(e){console.log(e)}}},{key:"destroy",value:function(){"destroy"!==this._status&&(this._debugLog("call destroy"),this.hide(),this._clearStore(),this._status="destroy")}},{key:"_clearStore",value:function(){this.st=null,this.aid=null,this.cid=null,this.pbpStyle=null,this.themeStyle=null,this.pbp=null,this.video=null,this.player=null,this.pbpComponent=null,this.timeLine=null,this.zebraStart=0,this.zebraEnd=null,this.zebraAreas=[],this.lastUpdateTime=null,this.firstRefreshFlag=!1,this.videoHeartbeatFirstFlag=!1,this.eventKey=null,this.pbpDebugApi=localStorage.getItem("pbp_debug_api")||"",this.pbpDebugKey=localStorage.getItem("pbp_debug_key")||"",this.debug=!!this.options.debug||"1"===localStorage.getItem("pbp_debug")}},{key:"_checkVersion",value:function(){this._debugLog("pbp.js version: ".concat(m)),localStorage.getItem("pbp_version")!==m&&localStorage.setItem("pbp_version",m)}},{key:"_setThemeStyle",value:function(e){this.themeStyle&&"show"===this._status&&document.head.removeChild(this.themeStyle),"1"===localStorage.getItem("pbpstate")&&(this.themeStyle=document.createElement("style"),this.themeStyle.innerHTML=".bui-slider .bui-track.bui-track-video-progress .bui-bar-normal.bui-bar.bui-bar-normal { background: rgba(".concat(e,", 1); }"),document.head.appendChild(this.themeStyle))}},{key:"_updatePbpConfig",value:function(){var e=l("pbp_theme_v4","b");e=_[e]?_[e]:_.b;var t=l("pbp_opacity_v3","m");t=y[t]?y[t]:y.m,this.st.opacity=t,this.st.fillColor="rgb(".concat(e.fillColor,")"),this.st.playedColor="rgb(".concat(e.playedColor,")"),this._setThemeStyle(e.playedColor)}},{key:"_setTheme",value:function(e){this._debugLog("call setTheme");var t=_[e]?_[e]:_.b;this.pbpComponent.fillRect.setAttribute("fill","rgb(".concat(t.fillColor,")")),this.pbpComponent.playedRect.setAttribute("fill","rgb(".concat(t.playedColor,")")),c("pbp_theme_v4",e),this._setThemeStyle(t.playedColor)}},{key:"_setHeight",value:function(e,t){e._debugLog("call setHeight");var i=w[t];e.pbp&&(e.pbp.style.height="".concat(i,"px")),c("pbp_height_v3",t)}},{key:"_setOpacity",value:function(e,t){e._debugLog("call setOpacity");var i=y[t];i&&(e.pbpComponent.group.setAttribute("fill-opacity",i),c("pbp_opacity_v3",t))}},{key:"_setPin",value:function(e,t){e._debugLog("call setPin"),e.pbp&&("1"===t?e.pbp.classList.add("pin"):e.pbp.classList.remove("pin")),c("pbp_pin_v3","1"===t?1:0)}},{key:"_initGuide",value:function(e){var t=localStorage.getItem("pbp_guide_closed"),i=document.getElementById(d);if("1"!==t&&!i){var a=document.createElement("style");a.innerHTML="#bilibili_pbp_guide { opacity: 0; position: absolute; z-index: 2; height: 36px; line-height: 36px; bottom: calc(100% + 12px); left: -194%; display: block; align-items: center; padding: 2px; color: #fff; background: #00a1d6; white-space: nowrap; border-radius: 4px; box-shadow: 0 3px 6px 0 rgba(0,0,0,.2); font-size: 12px; } .webfullscreen #bilibili_pbp_guide, .mode-fullscreen #bilibili_pbp_guide { left: -113%; } .bilibili-player .bilibili-player-area.video-control-show #bilibili_pbp_guide, .bilibili-player .bilibili-player-area .bilibili-player-video-control-wrap:hover #bilibili_pbp_guide { opacity: 1; } #bilibili_pbp_guide:hover { background: #00b5e5; } #bilibili_pbp_guide:hover .pbp-guide-tri { border-top: 8px solid #00b5e5 } .pbp-guide-text { color: white; padding-right: 8px; padding-left: 8px; } .pbp-guide-tri { border-top: 8px solid #00a1d6; border-left: 8px solid transparent; border-right: 8px solid transparent; position: absolute; top: 100%; right: calc(50% - 8px); }",document.head.appendChild(a),(i=document.createElement("div")).setAttribute("id",d);var r=document.createElement("span");r.setAttribute("class","pbp-guide-text"),r.innerText="新！《高能进度条》设置菜单";var n=document.createElement("span");n.setAttribute("class","pbp-guide-tri"),i.appendChild(r),i.appendChild(n),e.appendChild(i),localStorage.setItem("pbp_guide_closed","1")}}},{key:"_initPanel",value:function(e,t){this._debugLog("call _initPanel");var i=document.getElementById(u),a=document.getElementById(h),r=document.getElementsByClassName("bilibili-player-video-control-bottom-right")[0];if(!a){(a=document.createElement("style")).setAttribute("id",h),a.innerHTML="#bilibili_pbp_panel{position:relative}.pbp-panel-content-wrap{position:absolute;display:none;margin-left:-92px;bottom:41px}.webfullscreen .pbp-panel-content-wrap,.mode-fullscreen .pbp-panel-content-wrap{bottom:74px}.pbp-panel-content{cursor:auto;width:216px;background:rgba(21,21,21,.9);border-radius:2px;box-sizing:border-box;padding:12px 20px}.pbp-panel-icon-wrap{height:28px;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-transition:fill .3s;transition:fill .3s;vertical-align:middle;display:inline-block}.pbp-panel-icon{height:22px;width:22px}.webfullscreen .pbp-panel-icon,.mode-fullscreen .pbp-panel-icon{width:28px;height:28px}.pbp-panel-title{text-align:left;color:#fff;line-height:16px;font-size:12px}.pbp-panel-row{padding-bottom:8px}.pbp-panel-row:last-child{padding-bottom:0}.pbp-panel-row-content{display:flex;margin-top:4px}.pbp-panel-state-button{cursor:pointer;position:relative;border-radius:2px;color:#fff;text-align:center;margin-right:8px;background:hsla(0,0%,100%,.2);font-size:12px;flex:1;height:22px;line-height:22px}.pbp-panel-state-button:last-child{margin-right:0}.pbp-panel-state-button:hover{background:hsla(0,0%,100%,.4)}.pbp-panel-state-button.active{background:#00a1d6}.pbp-panel-state-button.active:hover{background:#00a1d6}.pbp-public-test-title{padding:1px 4px;display:inline-block;font-size:12px;-webkit-transform:scale(.7);transform:scale(.7);color:#fff;border-radius:4px;background:#f25d8e}.pbp-panel-description{color:white;font-size:12px;overflow:auto;white-space:normal}.pbp-panel-feedback{flex:1;font-size:12px;color:white;background:#f4598d;border-radius:4px;-webkit-transition:background-color .3s;transition:background-color .3s;height:22px;line-height:22px}.pbp-panel-feedback:hover{color:#fff;background-color:#ff85ad}.pbp-panel-qa{display:inline-block;background:gray;transform:scale(0.8);border-radius:50%;height:16px;width:16px;text-align:center;line-height:16px;margin-left:4px;position:relative}.pbp-panel-qa-tip{position:absolute;display:none;bottom:100%;padding:8px;border-radius:4px;left:100%;background-color:#fff;background:rgba(0,0,0,.8);white-space:nowrap}.pbp-panel-qa:hover .pbp-panel-qa-tip{display:block}.pbp-panel-theme-button{cursor:pointer;position:relative;border-radius:2px;color:#fff;margin-right:6px;flex:1;height:22px;border:1px solid rgba(0,0,0,.3)}.pbp-panel-theme-button:last-child{margin-right:0}.pbp-panel-theme-button.active{-webkit-box-shadow:0 0 1px 1px #fff;box-shadow:0 0 1px 1px #fff;border-color:#000}.pbp-panel-feedback-wrap{position:absolute;top:0;right:0;overflow:hidden;width:64px;height:64px}.pbp-panel-feedback-content{position:absolute;bottom:0;bottom:50%;left:50%;width:100%;height:100%;transform:rotate(45deg)}.pbp-panel-feedback-content-row{position:absolute;bottom:0;height:30%;width:100%;background:#f25d8e;box-shadow:0 2px 4px 0 rgba(0,0,0,.6)}.pbp-panel-feedback-link-wrap{height:100%;transform:scale(0.75)}.pbp-panel-feedback-link{font-size:12px;line-height:22px;color:white;display:block;text-align:center;width:100%}.pbp-panel-feedback-link:hover{color:white;text-decoration:underline}",document.head.appendChild(a)}i&&(r.removeChild(i),i=null),(i=document.createElement("div")).setAttribute("id",u),i.setAttribute("class","bilibili-player-video-btn");var n=document.createElement("span");n.setAttribute("class","bp-svgicon"),i.appendChild(n);var o=document.createElement("div");o.setAttribute("class","pbp-panel-content-wrap");var l=document.createElement("div");l.setAttribute("class","pbp-panel-content");function s(){p=0,setTimeout(function(){0===p&&o.setAttribute("style","display: none;")},80)}var p=0;i.addEventListener("mouseenter",function(){if(p=1,o.setAttribute("style","display: block;"),"1"!==localStorage.getItem("pbp_guide_closed")){var e=document.getElementById(d);e&&(i.removeChild(e),localStorage.setItem("pbp_guide_closed",1))}}),i.addEventListener("mouseleave",function(){s()}),o.addEventListener("mouseenter",function(){p=1}),o.addEventListener("mouseleave",function(){s()}),this._createPanelPbpRow(l,n),this._createPanelThemeRow(l),this._createPanelDescriptionRow(l),this._createPanelFeedbackRow(l),this.debug&&(this._createPanelHeightRow(l),this._createPanelOpacityRow(l),this._createPanelPinRow(l),this._createPanelDebugRow(l,e,t)),o.appendChild(l),i.appendChild(o),r.insertBefore(i,r.firstChild)}},{key:"_setPbpIcon",value:function(e,t){var i="1"===t?'<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 22 22"><path d="M15,19.05H7a5,5,0,0,1-5-5v-3.7a5,5,0,0,1,4.52-5l-1.3-1.2a1,1,0,0,1,0-1.42,1,1,0,0,1,1.41,0l2.71,2.5a.86.86,0,0,1,.13.14H12.6a1,1,0,0,1,.14-.15l2.7-2.5A1,1,0,1,1,16.8,4.17L15.49,5.38a5,5,0,0,1,4.51,5V12a.86.86,0,0,1,0,.16.91.91,0,0,1,0,.17v1.77A5,5,0,0,1,15,19.05ZM4,13.12v.93a3,3,0,0,0,3,3h8a3,3,0,0,0,3-3v-.93H14.36A.93.93,0,0,1,14,13a1.31,1.31,0,0,1-.31-.27l-.06-.1-.84-1.4-2.56,4.52A.88.88,0,0,1,10,16h0a1.08,1.08,0,0,1-.29.2,1.23,1.23,0,0,1-.42.07.89.89,0,0,1-.39-.09A1,1,0,0,1,8.59,16a1,1,0,0,1-.17-.25L7.13,13.12ZM8.65,11.7l.72,1.44,2.47-4.37A1.18,1.18,0,0,1,12,8.55a1,1,0,0,1,.29-.21,1,1,0,0,1,.41-.09.88.88,0,0,1,.41.08,1,1,0,0,1,.3.21.87.87,0,0,1,.17.21L15,11.13h3v-.77a3,3,0,0,0-3-3H7a3,3,0,0,0-3,3v.77H7.87a1.05,1.05,0,0,1,.71.44S8.63,11.65,8.65,11.7Z"/></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 22 22"><path d="M15,19.05H7a5,5,0,0,1-5-5v-3.7a5,5,0,0,1,4.52-5l-1.3-1.2a1,1,0,0,1,0-1.42,1,1,0,0,1,1.41,0l2.71,2.5a.86.86,0,0,1,.13.14H12.6a1,1,0,0,1,.14-.15l2.7-2.5A1,1,0,1,1,16.8,4.17L15.49,5.38a5,5,0,0,1,4.51,5V12a.86.86,0,0,1,0,.16.91.91,0,0,1,0,.17v1.77A5,5,0,0,1,15,19.05ZM4,13.12v.93a3,3,0,0,0,3,3h8a3,3,0,0,0,3-3v-.93ZM7,7.35a3,3,0,0,0-3,3v.77H18v-.76a3,3,0,0,0-3-3Z"/></svg>';e.innerHTML=i}},{key:"_createStateButtonGroup",value:function(a,r,e,n,o){for(var l,t=function(e,t){var i=document.createElement("div");i.innerHTML=e,t===n?(i.setAttribute("class","pbp-panel-state-button active"),l=i):i.setAttribute("class","pbp-panel-state-button"),i.onclick=function(){l.classList.remove("active"),i.classList.add("active"),l=i,o(a,t)},r.appendChild(i)},i=0;i<e.length;i++){var s=e[i];t(s.title,s.val)}}},{key:"_createPanelRow",value:function(e,t){var i,a=document.createElement("div");a.setAttribute("class","pbp-panel-row"),t&&((i=document.createElement("div")).innerHTML=t,i.setAttribute("class","pbp-panel-title"));var r=document.createElement("div");return r.setAttribute("class","pbp-panel-row-content"),i&&a.appendChild(i),a.appendChild(r),e.appendChild(a),r}},{key:"_createPanelFeedback",value:function(e){var t=document.createElement("div");t.setAttribute("class","pbp-panel-feedback-wrap");var i=document.createElement("div");i.setAttribute("class","pbp-panel-feedback-content");var a=document.createElement("div");a.setAttribute("class","pbp-panel-feedback-content-row");var r=document.createElement("div");r.setAttribute("class","pbp-panel-feedback-link-wrap");var n=document.createElement("a");n.setAttribute("class","pbp-panel-feedback-link"),n.setAttribute("href","https://www.bilibili.com/blackboard/activity-KMbzFht4z.html?from=panel"),n.setAttribute("target","_blank"),n.innerHTML="评价",r.appendChild(n),a.appendChild(r),i.appendChild(a),t.appendChild(i),e.appendChild(t)}},{key:"_createPanelPbpRow",value:function(e,r){var t=this._createPanelRow(e,"高能进度条"),n=0,o=0,i=localStorage.getItem("pbpstate");this._setPbpIcon(r,i);this._createStateButtonGroup(this,t,[{title:"开",val:"1"},{title:"关",val:"0"}],i,function(e,t){e._setPbpIcon(r,t),"1"===t?(localStorage.setItem("pbpstate",1),e.show()):(localStorage.setItem("pbpstate",0),e.hide());var i=(new Date).getTime();if(o=0===o||i-o<250?(n++,i):n=0,5===n){var a=e.debug?"0":"1";c("pbp_debug",a),window.location.reload()}})}},{key:"_createPanelDescriptionRow",value:function(e){var t=this._createPanelRow(e,null),i=document.createElement("div");i.setAttribute("class","pbp-panel-description"),i.innerHTML="代表多数用户拖动的位置或弹幕密集区，避免您错过精彩内容！",t.appendChild(i)}},{key:"_createPanelFeedbackRow",value:function(e){var t=this._createPanelRow(e,null),i=document.createElement("a");i.innerHTML="评价",i.setAttribute("class","pbp-panel-feedback"),i.setAttribute("target","_blank");i.setAttribute("href","https://www.bilibili.com/blackboard/activity-KMbzFht4z.html?from=panel&version=3.2.2"),t.appendChild(i)}},{key:"_createPanelHeightRow",value:function(e){var t=this._createPanelRow(e,"高度"),i=l("pbp_height_v3","m");i=w[i]?i:"m",this._createStateButtonGroup(this,t,[{title:"低",val:"l"},{title:"中",val:"m"},{title:"高",val:"h"}],i,this._setHeight)}},{key:"_createPanelOpacityRow",value:function(e){var t=this._createPanelRow(e,"透明度"),i=l("pbp_opacity_v3","m");i=y[i]?i:"m",this._createStateButtonGroup(this,t,[{title:"低",val:"l"},{title:"中",val:"m"},{title:"高",val:"h"}],i,this._setOpacity)}},{key:"_createPanelPinRow",value:function(e){var t=this._createPanelRow(e,'常驻模式<div class="pbp-panel-qa">?<div class="pbp-panel-qa-tip">当面板隐藏的时候保持高能进度条展示</div></div>'),i=l("pbp_pin_v3","0");this._createStateButtonGroup(this,t,[{title:"开",val:"1"},{title:"关",val:"0"}],i,this._setPin)}},{key:"_pinStateChange",value:function(e,t,i){var a=document.getElementById(b).classList;i?(this._setPin(this,"1"),e.innerHTML='<svg t="1571033023877" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3699" width="16" height="16"><path d="M726.646154 466.707692h-9.846154L649.846154 155.569231h17.723077c31.507692 0 57.107692-25.6 57.107692-57.107693s-25.6-57.107692-57.107692-57.107692H356.430769c-31.507692 0-57.107692 25.6-57.107692 57.107692s25.6 57.107692 57.107692 57.107693h17.723077l-64.984615 311.138461h-9.846154c-31.507692 0-57.107692 25.6-57.107692 57.107693s25.6 57.107692 57.107692 57.107692h165.415385v342.646154c0 31.507692 25.6 59.076923 59.076923 59.076923s59.076923-25.6 59.076923-59.076923V582.892308H728.615385c31.507692 0 57.107692-25.6 57.107692-57.107693s-27.569231-59.076923-59.076923-59.076923z" p-id="3700" fill="#ffffff"></path></svg>',t.innerText="关闭《高能进度条》常驻",a.add("pin")):(this._setPin(this,"0"),e.innerHTML='<svg t="1571033005936" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3385" width="16" height="16"><path d="M85.333333 224.853333 139.946667 170.666667 853.333333 884.053333 799.146667 938.666667 546.133333 685.653333 546.133333 938.666667 477.866667 938.666667 477.866667 682.666667 256 682.666667 256 597.333333 341.333333 512 341.333333 480.853333 85.333333 224.853333M682.666667 512 768 597.333333 768 682.666667 760.32 682.666667 341.333333 263.68 341.333333 170.666667 298.666667 170.666667 298.666667 85.333333 725.333333 85.333333 725.333333 170.666667 682.666667 170.666667 682.666667 512Z" p-id="3386" fill="#ffffff"></path></svg>',t.innerText="打开《高能进度条》常驻",a.remove("pin")),c("pbp_pin_v3",i?"1":"0")}},{key:"_initPin",value:function(){var i=this,e=document.getElementById(v),t=document.querySelector("."+g);(e=document.createElement("div")).setAttribute("id",v);var a=document.createElement("div");a.setAttribute("class","pbp-icon");var r=document.createElement("span");r.setAttribute("class","pbp-tips"),e.appendChild(a),e.appendChild(r);var n=this;t.appendChild(e);var o="1"===l("pbp_pin_v3","0");this._pinStateChange(a,r,o),e.addEventListener("click",function(e){var t="1"!==l("pbp_pin_v3","0");n._pinStateChange(a,r,t),window.pinClickCount||(window.pinClickCount=1),10<=window.pinClickCount&&(window.pinClickCount=1,c("pbp_debug",i.debug?"0":"1"),window.location.reload()),window.pinClickCount++})}},{key:"_createPanelThemeRow",value:function(e){var i,a=this,r=this._createPanelRow(e,"主题"),n=l("pbp_theme_v4","b");n=_[n]?n:"b";function t(e){var t=document.createElement("div");t.style.backgroundColor="rgb(".concat(_[e].playedColor,")"),e===n?(t.setAttribute("class","pbp-panel-theme-button active"),i=t):t.setAttribute("class","pbp-panel-theme-button"),t.onclick=function(){i.classList.remove("active"),t.classList.add("active"),i=t,a._setTheme(e)},r.appendChild(t)}t("b"),t("p"),t("g"),t("r")}},{key:"_createPanelDebugRow",value:function(e,i,t){var a=this._createPanelRow(e,"Debug"),r=document.createElement("select");r.setAttribute("style","width: 100%; font-size: 12px; color: black;"),r.addEventListener("change",function(){var e=r.selectedIndex,t=r.options[e].getAttribute("value");localStorage.setItem("pbp_debug_key",t),window.location.reload()}),Object.keys(t).forEach(function(e){var t=new Option(e,e);e===i&&t.setAttribute("selected",""),r.add(t)}),a.appendChild(r)}},{key:"_saveZebraAreas",value:function(){if(null!==this.zebraStart&&null!==this.zebraEnd){for(var e=0;e<this.zebraAreas.length;e++){var t=this.zebraAreas[e][0],i=this.zebraAreas[e][1];if(this.zebraStart>i){if(e+1!==this.zebraAreas.length)continue;this.zebraAreas.push([this.zebraStart,this.zebraEnd]);break}if(this.zebraStart>=t&&this.zebraEnd<=i)break;this.zebraStart<=t&&this.zebraEnd>=t&&this.zebraEnd<i?this.zebraAreas[e]=[this.zebraStart,i]:this.zebraStart>=t&&this.zebraStart<=i&&this.zebraEnd>i?this.zebraAreas[e]=[t,this.zebraEnd]:this.zebraAreas.splice(e,0,[this.zebraStart,this.zebraEnd]);break}if(1<this.zebraAreas.length){for(var a=[],r=this.zebraAreas[0][1],n=0,o=1;o<this.zebraAreas.length;o++){var l=this.zebraAreas[o][0],s=this.zebraAreas[o][1];l<r?(r<s&&(this._debugLog("delete merge end"),this.zebraAreas[n]=[this.zebraAreas[n][0],s],r=s,n=o),this._debugLog("delete: ".concat(o,", ").concat(l,", ").concat(s)),a.push(o)):(r=s,n=o)}var p=this;a.forEach(function(e,t){p._debugLog("delete start: ".concat(e-t)),p.zebraAreas.splice(e-t,1)})}else this.zebraAreas.push([this.zebraStart,this.zebraEnd]);this._refreshZebraClipPath()}}},{key:"_recoverZebraDataFromCache",value:function(){var e=window.wsLocalStorage.get("pbp_zebra_cache_"+this.cid);if(e)try{this.zebraAreas=JSON.parse(e)}catch(e){this._debugLog("Zebra data parse error"+e)}else{var t=null;try{t=JSON.parse(window.wsLocalStorage.get("pbp_zebra_cache_timeline"))}catch(e){this._debugLog("Timeline parse error "+e),t=[]}finally{if(t)if(100<=t.length){var i=t.shift().split("\n");window.wsLocalStorage.delete("pbp_zebra_cache_"+i[1]),window.wsLocalStorage.delete("pbp_rec_loader_"+i[0]),window.wsLocalStorage.set("pbp_zebra_cache_timeline",t,{exp:3600})}else t.push(this.aid.toString()+"\n"+this.cid.toString()),window.wsLocalStorage.set("pbp_zebra_cache_timeline",t,{exp:3600});else(t=[]).push(this.aid.toString()+"\n"+this.cid.toString()),window.wsLocalStorage.set("pbp_zebra_cache_timeline",t,{exp:3600});this.timeLine=t}}window.wsLocalStorage.get("pbp_rec_loader_"+this.aid)||window.wsLocalStorage.set("pbp_rec_loader_"+this.aid,this.cid,{exp:3600})}},{key:"_cacheZebraData",value:function(){if(this.zebraAreas){this._debugLog("call _cacheZebraData");try{window.wsLocalStorage.set("pbp_zebra_cache_"+this.cid,JSON.stringify(this.zebraAreas),{exp:3600})}catch(e){this._debugLog("Zebra data stringify or save error"+e)}}}},{key:"_generateBezierCurvePath",value:function(e,t,i){var a=.2*i,r=e[1].wPercentage*t/2,n=["M 0 100 L 0 ".concat(i-a)],o=0,l=i-a;e.push({wPercentage:1,hPercentage:0});for(var s=1;s<e.length;s++){var p=e[s],c=p.wPercentage*t,d=i-(a+.8*p.hPercentage*i),b=o+r;n.push("C ".concat(b.toFixed(1)," ").concat(l.toFixed(1),", ").concat(b.toFixed(1)," ").concat(d.toFixed(1),", ").concat(c.toFixed(1)," ").concat(d.toFixed(1))),o=c,l=d}n.push("L 1000 100 Z");var u=n.join(" ");return this._debugLog("call _generateBezierCurvePath: ".concat(u)),u}},{key:"_generateZebraPath",value:function(e,t){for(var i=[],a=0;a<e.length;a++){var r=e[a],n=t*r[0],o=t*r[1];i.push("M ".concat(n.toFixed(1)," 100 H ").concat(o.toFixed(1)," V 0 H ").concat(n.toFixed(1)," Z"))}var l=i.join(" ");return this._debugLog("call _generateZebraPath: ".concat(l)),l}},{key:"_create",value:function(){if(this.st){var e=document.getElementById(b);if(!e){(e=document.createElement("div")).setAttribute("id",b);var i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("viewBox","0 0 ".concat(f," ").concat(100)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("width","100%"),i.setAttribute("height","100%");var t=document.createElementNS("http://www.w3.org/2000/svg","defs"),a=document.createElementNS("http://www.w3.org/2000/svg","clipPath");a.setAttribute("id","pbp-curve-path"),a.setAttribute("clipPathUnits","userSpaceOnUse");var r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d",this._generateBezierCurvePath(this.st.points,f,100)),a.appendChild(r);var n=document.createElementNS("http://www.w3.org/2000/svg","clipPath");n.setAttribute("id","pbp-played-path"),n.setAttribute("clipPathUnits","userSpaceOnUse");var o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttribute("x","0"),o.setAttribute("width","0"),o.setAttribute("y","0"),o.setAttribute("height","100%"),n.appendChild(o);var l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",this._generateZebraPath(this.zebraAreas,f)),n.appendChild(l),t.appendChild(a),t.appendChild(n);var s=document.createElementNS("http://www.w3.org/2000/svg","g");s.setAttribute("fill-opacity",this.st.opacity),s.setAttribute("clip-path","url(#pbp-curve-path)"),s.setAttribute("class","bilibili-player-videoshot-area");var p=document.createElementNS("http://www.w3.org/2000/svg","rect");p.setAttribute("x","0"),p.setAttribute("y","0"),p.setAttribute("width","100%"),p.setAttribute("height","100%"),p.setAttribute("fill",this.st.fillColor),s.appendChild(p);var c=document.createElementNS("http://www.w3.org/2000/svg","rect");c.setAttribute("x","0"),c.setAttribute("y","0"),c.setAttribute("width","100%"),c.setAttribute("height","100%"),c.setAttribute("fill",this.st.playedColor),c.setAttribute("clip-path","url(#pbp-played-path)"),s.appendChild(c);var d=document.createElementNS("http://www.w3.org/2000/svg","line");d.setAttribute("y1","0"),d.setAttribute("y2","100%"),d.setAttribute("style","stroke: ".concat("rgba(255,255,255,0.2)","; stroke-width: 1;")),s.appendChild(d),i.appendChild(t),i.appendChild(s),e.appendChild(i),document.getElementsByClassName(g)[0].appendChild(e),window.player.getPlayerState()&&window.player.getPlayerState().controller.show?e.classList.add("show"):e.classList.remove("show"),s.addEventListener("click",function(e){var t=(e.clientX-i.getBoundingClientRect().left)/i.getBoundingClientRect().width;window.player.seek(t*window.player.getDuration()),window.player.track("slidepbp")}),this.pbp=e,this.pbpComponent={pbpSvg:i,group:s,currentRect:o,zebraPath:l,fillRect:p,playedRect:c,currentTimeLine:d}}}}},{key:"_refresh",value:function(){if(null!==this.zebraStart&&null!==this.zebraEnd&&this.zebraEnd>this.zebraStart){var e=this.pbpComponent.currentRect,t=100*this.zebraStart,i=100*this.zebraEnd-t;e.setAttribute("x","".concat(t.toFixed(2),"%")),e.setAttribute("width","".concat(i.toFixed(2),"%"))}var a=window.player.getCurrentTime();this.firstRefreshFlag||(a=0,this.firstRefreshFlag=!0);var r=a/window.player.getDuration()*f-.5;r=0<=r?r:0;var n=this.pbpComponent.currentTimeLine;n.setAttribute("x1","".concat(r)),n.setAttribute("x2","".concat(r))}},{key:"_refreshZebraClipPath",value:function(){this.pbpComponent.zebraPath.setAttribute("d",this._generateZebraPath(this.zebraAreas,f))}},{key:"_observerChange",value:function(){var o=this;this._debugLog("observer change"),this.videoSeekingCallback=function(e){o._saveZebraAreas(),o.zebraStart=null,o.zebraEnd=null,o.lastUpdateTime=null},this.videoProgressUpdateCallback=function(e,t){var i=window.player.getDuration(),a=t.currentTime/i||0,r=a*i,n=!1;o.lastUpdateTime&&(n=r<o.lastUpdateTime||1.5<r-o.lastUpdateTime),n?(o._debugLog("invalid update, ignore."),o._saveZebraAreas(),o.zebraStart=null,o.zebraEnd=null,o.lastUpdateTime=null):(null===o.zebraStart&&(o.zebraStart=Number(a.toFixed(4))),o.zebraEnd=Number(a.toFixed(4)),o.lastUpdateTime=r),o._refresh()};var i=this.pbp.classList;this.videoControlbarCallback=function(e,t){t.show?i.add("show"):i.remove("show")},this.videoHeartbeatCallback=function(e,t){if(o.videoHeartbeatFirstFlag){var i=window.player.getCurrentTime()/window.player.getDuration()||0;i=Number(i.toFixed(4)),o._debugLog("call video heartbeat: ".concat(i,", zebra time: ").concat(o.zebraStart," - ").concat(o.zebraEnd)),o.zebraEnd=i,o._saveZebraAreas(),o.zebraStart=o.zebraEnd,o.lastUpdateTime=null,o._cacheZebraData()}else o.videoHeartbeatFirstFlag=!0},this.video.addEventListener("seeking",this.videoSeekingCallback),window.player.addEventListener("video_controlbar",this.videoControlbarCallback),window.player.addEventListener("video_heartbeat",this.videoHeartbeatCallback),window.player.addEventListener("video_progress_update",this.videoProgressUpdateCallback)}},{key:"_calculatePercentage",value:function(e,t){var i=window.player.getDuration(),a=Math.floor(i/t);this._debugLog("video_len:".concat(a," data_len:").concat(e.length)),a>e.length&&(e=e.concat(new Array(a-e.length).fill(0)));for(var r=e.length*t,n=e.reduce(function(e,t){return t<e?e:t},0),o=[],l=0;l<e.length;l++){var s=e[l],p=s/n;p=p||0,o.push({value:s,hPercentage:p,wPercentage:l*t/r})}return o}},{key:"_debugLog",value:function(){for(var e,t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];this.debug&&(e=console).log.apply(e,["[PBP DEBUG]: "].concat(i))}},{key:"_injectBiliPlayer",value:function(){var r=this,n=10;return new Promise(function e(t,i){var a=document.querySelector(".".concat("bilibili-player-video-wrap"));if(window.BilibiliPlayer&&a)r.aid=+window.aid||window.bvid,r.cid=+window.cid,r.player=a,t();else{if(0===(n-=1))return void i("miss BilibiliPlayer");setTimeout(function(){e(t,i)},500)}})}},{key:"stateStore",get:function(){var e={status:"disable",data:[],version:"3.2.2"};this.st&&this.st.points&&(e.data=this.st.points),e.data.length?"show"===this._status?e.status="enable":e.status="disable":e.status="enableFail";var t=l("pbp_pin_v3","0");t="1"===t?t:"0";var i=l("pbp_height_v3","m");i=w[i]?i:"m";var a=l("pbp_opacity_v3","m");a=y[a]?a:"m";var r=l("pbp_theme_v4","b");r=_[r]?r:"b";var n=l("pbp_debug","0");return n="1"===n?n:"0",e.pbpstatus=e.status,e.pbptag=this._pbptag,e.pbptag.pbppin=Number(t),e.pbptag.pbpheight=i,e.pbptag.pbpopacity=a,e.pbptag.theme=r,e.pbptag.debug=n,e.pbptagstr=this._pbptagstr+"&pbppin_"+t+"&pbpheight_"+i+"&pbpopacity_"+a+"&pbptheme_"+r+"&pbpdebug_"+n,e}}]),a}()});